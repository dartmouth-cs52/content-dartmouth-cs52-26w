<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      max-width: 85%;
      margin: 0 auto;
      padding: 2rem;
      color: #333;
    }
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      margin-bottom: 0;
    }
    h1 {
      font-size: 2em;
      margin-top: 2rem;
      background-color: #FBF3DB;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      display: inline-block;
    }
    h2 {
      font-size: 1.5em;
      margin-top: 1.5rem;
      background-color: #DDEBF1;
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      display: inline-block;
    }
    h3 { font-size: 1.25em; margin-top: 1rem; }
    /* Heading block wrappers */
    .heading-block { margin: 0; padding: 0; }
    .heading-block h1, .heading-block h2, .heading-block h3 { margin-top: 0; }
    .h1-block { margin-top: 2rem; }
    .h2-block { margin-top: 1.5rem; }
    .h3-block { margin-top: 1rem; }
    p { margin-bottom: 1em; font-size: 16px; }
    ul, ol {
      margin-bottom: 1em;
      padding-left: 1.5em;
      list-style-position: outside;
    }
    ul { list-style-type: disc; }
    ol { list-style-type: decimal; }
    li {
      margin-bottom: 0.25em;
      display: list-item;
      font-size: 16px;
    }
    ul ul, ol ul { list-style-type: circle; }
    ul ul ul, ol ul ul { list-style-type: square; }
    ol ol { list-style-type: lower-alpha; }
    ol ol ol { list-style-type: lower-roman; }
    code {
      background: #f6f8fa;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 85%;
    }
    pre {
      background: #f6f8fa;
      padding: 1em;
      border-radius: 6px;
      overflow-x: auto;
      margin-bottom: 1em;
    }
    pre code {
      background: none;
      padding: 0;
      font-size: 100%;
    }
    /* Code block with header and line numbers */
    .code-block {
      background: #1e1e1e;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
    }
    .code-block .code-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      background: #161616;
      border-bottom: 1px solid #333;
    }
    .code-block .code-lang {
      color: #9ca3af;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .code-block .code-body {
      display: flex;
      padding: 1rem 0;
    }
    .code-block .line-numbers {
      display: flex;
      flex-direction: column;
      padding: 0 1rem 0 1rem;
      text-align: right;
      user-select: none;
      color: #6b7280;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 1rem;
      line-height: 1.625;
    }
    .code-block .line-numbers .line-number {
      display: block;
    }
    .code-block pre {
      flex: 1;
      background: transparent;
      margin: 0;
      padding: 0 1rem 0 0;
      overflow-x: auto;
    }
    .code-block pre code {
      color: #d4d4d4;
      font-size: 1rem;
      line-height: 1.625;
    }
    .terminal-block {
      background: #1e1e1e;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1em;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .terminal-block .terminal-header {
      background: linear-gradient(180deg, #3c3c3c 0%, #2d2d2d 100%);
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid #1a1a1a;
    }
    .terminal-block .terminal-dots {
      display: flex;
      gap: 8px;
    }
    .terminal-block .terminal-dots span {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .terminal-block .terminal-dots span:nth-child(1) { background: #ff5f57; }
    .terminal-block .terminal-dots span:nth-child(2) { background: #febc2e; }
    .terminal-block .terminal-dots span:nth-child(3) { background: #28c840; }
    .terminal-block .terminal-title {
      flex: 1;
      text-align: center;
      color: #9ca3af;
      font-size: 0.8rem;
      font-weight: 500;
      margin-right: 60px;
    }
    .terminal-block pre {
      background: transparent;
      margin: 0;
      padding: 1rem;
      font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .terminal-block pre code {
      background: transparent;
      color: #d1d5db;
      padding: 0;
      font-size: inherit;
      font-family: inherit;
    }
    .terminal-block .terminal-prompt {
      color: #4ade80;
      user-select: none;
    }
    blockquote {
      border-left: 4px solid #ddd;
      margin: 1em 0;
      padding-left: 1em;
      color: #666;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1em;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.75em;
      text-align: left;
    }
    th {
      background: #f6f8fa;
      font-weight: 600;
    }
    a {
      color: #0969da;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    img {
      max-width: 100%;
      height: auto;
    }
    .callout {
      background: #f7f6f3;
      padding: 1em;
      border-radius: 6px;
      display: flex;
      gap: 0.75em;
      margin-bottom: 1em;
    }
    .callout-emoji {
      font-size: 1.25em;
    }
    .alert {
      padding: 1rem;
      border-radius: 6px;
      border-left: 4px solid;
      margin-bottom: 1em;
      display: flex;
      gap: 0.75rem;
    }
    .alert-info {
      background: #dbeafe;
      border-left-color: #3b82f6;
    }
    .alert-warning {
      background: #fef3c7;
      border-left-color: #f59e0b;
    }
    .alert-error {
      background: #fee2e2;
      border-left-color: #ef4444;
    }
    .alert-success {
      background: #d1fae5;
      border-left-color: #10b981;
    }
    .alert-note {
      background: #f3f4f6;
      border-left-color: #6b7280;
    }
    .alert::before {
      content: '';
      font-size: 1.25em;
    }
    .alert-info::before { content: 'üí°'; }
    .alert-warning::before { content: '‚ö†Ô∏è'; }
    .alert-error::before { content: 'üö®'; }
    .alert-success::before { content: '‚úÖ'; }
    .alert-note::before { content: 'üìå'; }
    .checklist-item {
      display: flex;
      align-items: start;
      gap: 0.75rem;
      margin-bottom: 0.5em;
    }
    .checklist-item input[type="checkbox"] {
      margin-top: 0.375rem;
      width: 1rem;
      height: 1rem;
      cursor: not-allowed;
    }
    .checklist-item input[type="checkbox"]:checked + span {
      text-decoration: line-through;
      color: #9ca3af;
    }
    .file-tree {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
    }
    .file-tree::before {
      content: attr(data-title);
      display: block;
      background: #f3f4f6;
      color: #6b7280;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid #e5e7eb;
    }
    .file-tree pre {
      background: transparent;
      color: #374151;
      margin: 0;
      padding: 1rem;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    .video-embed {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin-bottom: 1em;
      border-radius: 6px;
    }
    .video-embed iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .file-download {
      background: #f6f8fa;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
      padding: 1em;
      margin-bottom: 1em;
    }
    .file-download a {
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      color: #0969da;
      font-weight: 500;
    }
    .file-download a::before {
      content: 'üìé';
    }
    .page-link-block {
      display: block;
      width: 100%;
      padding: 0.5rem;
      margin: 0 -0.5rem 1em -0.5rem;
      border-radius: 0.25rem;
      transition: background-color 0.15s;
      cursor: pointer;
    }
    .page-link-block:hover {
      background-color: #f3f4f6;
    }
    .page-link-block a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #111827;
      font-weight: 600;
      text-decoration: underline;
    }
    .page-link-block a:hover {
      text-decoration: underline;
    }
    .page-link-block a::before {
      content: 'üìÑ';
      font-size: 1rem;
      flex-shrink: 0;
    }
    .profile-card {
      display: flex;
      flex-direction: column;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
      background: white;
      width: 100%;
    }
    .columns .profile-card {
      max-width: 100%;
    }
    .profile-card img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      background: #f3f4f6;
      margin: 0;
    }
    .profile-card > div {
      padding: 1rem;
    }
    .profile-card strong {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }
    .profile-card em {
      display: block;
      font-size: 14px;
      font-style: normal;
      color: #6b7280;
      margin-top: 0.25rem;
    }
    .embed-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin-bottom: 1em;
      border-radius: 6px;
      border: 1px solid #e1e4e8;
    }
    .embed-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .columns {
      display: grid;
      gap: 1.5rem;
      margin-bottom: 1em;
    }
    .columns[data-columns="2"] {
      grid-template-columns: repeat(2, 1fr);
    }
    .columns[data-columns="3"] {
      grid-template-columns: repeat(3, 1fr);
    }
    .columns[data-columns="4"] {
      grid-template-columns: repeat(4, 1fr);
    }
    .column {
      min-height: 50px;
    }
    @media (max-width: 768px) {
      .columns {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>

<p>Type: lab<br>week: Week 3<br>Created time: February 7, 2022 9:20 PM<br>Dates: April 18, 2025 ‚Üí April 27, 2025<br>published: Yes</p>
<h1 style="background-color: #DDEBF1;">React Notes</h1>
<p>Where we dive deeper into React and construct a realtime collaborative post-it note app with React!</p>
<p><a href="http://res.cloudinary.com/dali-lab/video/upload/ac_none,w_800,h_510/v1546203223/cs52/live-notes-1080p.webm">live-notes-1080p.webm</a></p>
<h3>Part 1</h3>
<p>We will start with a version of the app that does not have a backend, it‚Äôll use state for notes but if you refresh the page all your hard work will disappear ‚Äî and it‚Äôll only work in one browser window.</p>
<p>üñºÔ∏è¬†FYI, you all allowed to use component libraries now!  So if you wanted to use something like <a href="https://ui.shadcn.com/">https://ui.shadcn.com/</a> or <a href="https://chakra-ui.com/">https://chakra-ui.com/</a> or <a href="https://mantine.dev/">https://mantine.dev/</a> or <a href="https://mui.com/">https://mui.com/</a>, you are welcome to!</p>
<h3>Part 2</h3>
<p>Then we will add in Firebase for persistent storage. Firebase is a backend as a service (BAAS). It provides a simple JSON data store (<a href="https://firebase.google.com/docs/database/">Firebase Realtime Database</a>) that has some nice realtime properties. You can subscribe to change events on collections of objects, this is perfect to use with React!</p>
<p>This will involve a small bit of refactoring, but will demonstrate how you can prototype frontend and then add in server side later.</p>
<p>In this version your notes will persist and will synchronize in real-time so multiple people can collaborate.</p>
<h2 style="background-color: #FBF3DB;">Let‚Äôs Start</h2>
<p>üöÄ Assuming you did the pre-lab, then you have already started! </p>
<p>If not then remember to use the repo provided for you by <a href="http://classmoji.brunchlabs.com">classmoji.brunchlabs.com</a>.  Then you‚Äôll pull in your vite+babel+eslint+(with the prior short react additions) starter code like so:</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><div class="code-block"><div class="code-header"><span class="code-lang">bash</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div><pre><code class="language-bash">#make sure you are in your project directory
git remote add starter your-starterpack-github-url
git pull starter main --allow-unrelated-histories</code></pre></div></div></div>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><div class="code-block"><div class="code-header"><span class="code-lang">bash</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-bash"># also don&#39;t forget to run:
npm install #to fetch all your package dependencies</code></pre></div></div></div>
<h2 style="background-color: #FBF3DB;">What are we building?!</h2>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/double-window-1767548477530.png" alt=""></p>
<p>A post-it note style app where users can add notes, move them around, edit them, and delete them. This React app will use Firebase as its backend to store collections of notes. The position of notes will also be stored, so people in multiple browsers can edit and arrange them in real-time. The notes themselves will support markdown notation and editing.</p>
<p>For Part 1, the app will store state in memory only and won‚Äôt use Firebase yet. But here are the overall specs of the full project.</p>
<h3>Minimal Functional Specs</h3>
<ul>
<li>Notes App:<ul>
<li>Add a note:<ul>
<li>can either be a single title input + create button</li>
<li>or a modal if you prefer with all fields</li>
</ul>
</li>
<li>Delete a note</li>
<li>Move a note in x, y<ul>
<li>optionally in z <em>(zIndex)</em></li>
</ul>
</li>
<li>Edit a note:<ul>
<li>title, content</li>
</ul>
</li>
<li>Notes:<ul>
<li>have title and content</li>
<li>content has formatting support (markdown or other)</li>
</ul>
</li>
<li>Persists all changes to Firebase in realtime</li>
<li>Updates based on Firebase events</li>
<li>is at least as stylish as these mockups</li>
</ul>
</li>
</ul>
<p><em>Note: you are welcome to use CSS frameworks to help with styling (but be careful as the JS that comes with some of them does not play nice with react).</em></p>
<h2 style="background-color: #FBF3DB;">App Component</h2>
<p>The skeleton for this is already in the starter. Does it need to be a smart component? It depends on how you organize your components, but you could do something similar to the react short assignment where the <em>App</em> component holds most of the state.</p>
<p>Here is a test note that I used to start with with the minimal set of fields:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div><pre><code class="language-jsx">{
  title: &#39;testing&#39;,
  text: &#39;I is a note&#39;,
  x: 400,
  y: 12,
  zIndex: 26,
}</code></pre></div></div>
<h2 style="background-color: #FBF3DB;">Immer JS</h2>
<p>Before we go on, we should talk about <a href="https://immerjs.github.io/immer/">Immer</a>. And immutable data structures in general!</p>
<p>We‚Äôve discussed how mutable data structures can be dangerous and unpleasant ‚Äî data changing without you knowing about, etc. React is built around the idea that state in particular should be immutable. You have <strong>new</strong> states, but you don‚Äôt alter existing state. As we dig deeper into react and functional programming we‚Äôll see the insistence on <strong>pure</strong> functions and immutable data more and more.</p>
<p>For this assignment we‚Äôre going to play with a library for making our state immutable and easier to work with at the same time.</p>
<p>There are several reasons for this:</p>
<ul>
<li>in Part 2 we‚Äôll be handing over state to Firebase  and we are going to structure our data to make that easier / more similar to how firebase works.</li>
<li>cleaner api than trying to make sure we remember to deep clone objects to guarantee it is a new state object.</li>
</ul>
<p>Feel free to peruse the Immer <a href="https://immerjs.github.io/immer/produce">docs</a> for more info on how and why it is cool.</p>
<p>üöÄ Install Immer</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><div class="code-block"><div class="code-header"><span class="code-lang">bash</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-bash">npm install immer</code></pre></div></div></div>
<p>üöÄ¬†Now wherever you run a setState you can use <code>produce</code> to create the new state!</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span></div><pre><code class="language-jsx">// for example if your notes state looked something like this
// notes = { id1: { title: &#39;hi&#39; text: &#39;a&#39;},  id2: { title: &#39;bye&#39;, text: &#39;b&#39;}}

// to update you could run something like this
// const updatedFields = {title: &#39;howdy&#39;}
// using hooks to set the state of notes
setNotes(
  produce((draftState) =&gt; {
    draftState[&#39;id1&#39;] = { ...draftState.notes[&#39;id1&#39;], ...updatedFields };
  }),
);</code></pre></div></div>
<p>You might ask, why did we make notes an object rather than an array?</p>
<p>Good question! </p>
<ul>
<li>this will make deletion and updating quicker as <em>O(1)</em> hashmap lookups rather than linear list traversal.</li>
<li>a dictionary/hashmap/object is basically the format that Firebase will give us later so it will make refactoring our code in Part 2 much easier</li>
</ul>
<p>‚ö†Ô∏è¬†You will most likely get eslint yelling at you for assigning to a parameter.  That is it doesn‚Äôt like that you have a function with draftState as an argument that you are then reassigning.  That is what Immer does though so I would recommend ignoring it like so:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-jsx">// add this rule to your eslintrc
&quot;no-param-reassign&quot;: [&quot;error&quot;,{ &quot;props&quot;: true, &quot;ignorePropertyModificationsForRegex&quot;: [ &quot;^draft&quot;]}]</code></pre></div></div>
<h2 style="background-color: #FBF3DB;">Notes State</h2>
<p>Our main state object (note you may also have react components that have local state for things like editing or for driven fields) is going to simply be a javascript object that looks something like this:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span></div><pre><code class="language-jsx">// assuming our state starts with
const [notes, setNotes] = useState({});

// and that our overall states looks something like this, a map of maps
{
  id: {
    title: &#39;&#39;,
    text: &#39;&#39;,
    x: 0,
    y: 0,
    zIndex:0,
  },
  id2: { ... },
}</code></pre></div></div>
<p>An object with unique note <code>id</code>s for the keys and note objects as values. Since <code>id</code> is not inside of the note object this will require a couple of workarounds, but in general is a common way of storing things in a JSON. You are welcome to duplicate the <code>id</code> inside of the note object also if you find that easier.</p>
<p>In Part 2 we will be getting something like this from Firebase:</p>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/lab3-firebase-1767548477530.png" alt="Lab3-firebase.png"></p>
<p>But for now let‚Äôs worry about our own state ‚Äî We‚Äôll do Firebase later.</p>
<p>Wait, but where do the unique note <code>id</code>s come from? Eventually they‚Äôll be generated by Firebase or our own database, but for now we can just use an integer counter. This is <strong><a href="https://medium.com/@robinpokorny/index-as-a-key-is-an-anti-pattern-e0349aece318?source=linkShare-6b351af67702-1488669847">not good practice</a></strong> because if you have clashes in keys you can and will get weird behavior as react can‚Äôt tell the elements apart. Again - once we move to using a database unique keys will be generated for us. Here‚Äôs a good explanation of why <a href="https://stackoverflow.com/questions/28329382/understanding-unique-keys-for-array-children-in-react-js#answer-43892905">unique and unchanging keys are necessary</a>.</p>
<h2 style="background-color: #FBF3DB;">Immer &amp; You</h2>
<p>Here‚Äôs some tips about dealing with a few different state use cases and how Immer is going to help us.</p>
<p>You can think of Immer <code>produce</code> as a helper function to <code>setState</code> that will take in previousState as an argument which you can then modify (mutate) and then Immer will produce a new version of it. It keeps track of changes and is performant in how it returns newState.  Remember that what React expects, like a state machine, is a brand new state, not a modified object/array/string etc.</p>
<p><strong>Deletions</strong>:</p>
<p>Here‚Äôs an example of using it for setting a new notes state on deletion of a note.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span></div><pre><code class="language-jsx">
// instead of some obtuse code for filtering an object to return a new object sans that specific one
setNotes((prevState) =&gt; ({
  Object.fromEntries(Object.entries(prevState).filter( ([note_id, note]) =&gt; { note_id != id}))
}));

// we can use produce and simply modify
setNotes(
    produce((draft) =&gt; {
        delete draft[id];
    }),
);

// we could also do it this way:
// const updater = 	produce((draft) =&gt; {
//		delete draft[id];
//	}),
//setNotes(updater);</code></pre></div></div>
<p><strong>Additions</strong>:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div><pre><code class="language-jsx">setNotes(
  produce((draft) =&gt; {
    //draft.notes[id] = newNote if you are using class components with a nested object for state
    // for hooks, draft is already notes
    draft[id] = newNote;
  }),
);</code></pre></div></div>
<p>If we were to do this without produce and with a plain array it wouldn‚Äôt be too bad, something like <code>[...notes, newNote]</code>, but if we were to do this with a javascript object, we‚Äôd first need to clone the object, which can get tricky for nested objects.</p>
<p>Here is how you could shallow clone an object:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-jsx">// newNote = { title: &#39;&#39;, etc }
const newNotes = { ...notes, newNoteID: newNote };</code></pre></div></div>
<p>Confused? This uses spread notation to copy out all the top level keys from the previous notes into the new <code>{}</code> object! However, it only does the top level properties, so each nested object is still a reference rather than clone. Deep cloning is hard and slow if you are doing it manually. Immer makes it speedy and most importantly if you get used to using Immer to <code>produce</code> new state for <code>setState</code> you will never have weird state mutation bugs. </p>
<p>Great, now that you know how to clone an object we‚Äôll do that for updating a note!</p>
<p><strong>Updates</strong>:</p>
<p>Now that we know how to take an object and merge properties on it we can use that as our update function:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div><pre><code class="language-jsx">setNotes(
  produce((draft) =&gt; {
    draft[id] = { ...draft[id], ...fields };
  }),
);</code></pre></div></div>
<h3>How Do You Iterate Through An Object?</h3>
<p>If you are iterating through your Object, you might find that you need to extract both the key (the id) and the value (the note).</p>
<p>Thankfully we have a nice function <code>Object.entries</code> that returns an array of arrays like so <code>[[key, value]]</code> so you can use the array function <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map">map</a> over that and return the instantiation of a note component (for instance).</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span></div><pre><code class="language-jsx">Object.entries(props.notes).map(([id, note]) =&gt; {
  // perhaps you might return some jsx here :-)
  // return (&lt;Note id={id} note={note} /*...*/ &lt;/Note&gt;) // for instance maybe
});</code></pre></div></div>
<h2 style="background-color: #FBF3DB;">Note Component</h2>
<p>Ok, so you will probably need a <em>Note</em> component. What might a <em>Note</em> do?</p>
<ul>
<li>A Note:<ul>
<li>displays title</li>
<li>displays content</li>
<li>is draggable</li>
<li>is editable</li>
<li>is deletable</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/note-1767548477530.png" alt=""></p>
<h2 style="background-color: #FBF3DB;">Displaying Title and Content</h2>
<p>Is left as an exercise for the reader. üò°</p>
<h3>Dragging</h3>
<p>Dragging is a bit tricky, but you can simplify your life by using a component from the onlines. I recommend <a href="https://github.com/react-grid-layout/react-draggable">react-draggable</a>. <em>(remember we are using <code>npm</code> for package dependencies)</em></p>
<p>The basic idea is that you would import this new component just like you have been with your own components and then it has some props that you pass into it for configuration.</p>
<p>Here is an example:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span></div><pre><code class="language-jsx">&lt;Draggable
  handle=&quot;.class-of-note-mover-element&quot; // this is for you to define, what part of the note do you want to drag by
  nodeRef={draggableRef}
  grid={[25, 25]} // snapping to grid pixels
  defaultPosition={{ x: 20, y: 20 }} //if no position given
  position={{ x: yourX, y: yourY, width: yourWidth, height: yourHeight }}
  onStart={handleStartDrag}
  onDrag={handleDrag}
  onStop={handleStopDrag}
&gt;
  &lt;div ref={draggableRef}&gt;
    YOUR ACTUAL NOTE HERE title, content, drag handle etc
  &lt;/div&gt;
&lt;/Draggable&gt;;</code></pre></div></div>
<p>The way to use this component is to wrap whatever JSX you want in your <em>Note</em> render method in <code>&lt;Draggable&gt;</code>.</p>
<p>Note the 3 callbacks. <code>handleStart</code>, <code>handleDrag</code>, <code>handleStop</code>. You would use these to drive the position of the note. You‚Äôll want the position to be part of the note object as eventually we will synchronize using a cloud component. You may find that you only need to implement <code>handleDrag</code>.</p>
<p>In particular, Draggable will call the function <strong>you</strong> provide to <code>onDrag</code> with two arguments, let‚Äôs call them <code>(e, data)</code>. ‚û†Just to save you some digging, <code>data</code> will have <code>x</code> and <code>y</code> components so you can extract them and use them for your <code>note.position</code> state. </p>
<p><em>‚ö†Ô∏è¬†Note: you do not need to do anything with calculating deltas etc, draggable will give you the new x, y coords directly.</em> </p>
<p>Here‚Äôs a potential component hierarchy you could end up with:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">HTML</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span></div><pre><code class="language-html">&lt;Note&gt;
  &lt;Draggable&gt;
    &lt;div&gt;&lt;/div&gt;
  &lt;/Draggable&gt;
  &lt;Note&gt;
    &lt;Draggable&gt;
      &lt;div&gt;&lt;/div&gt;
    &lt;/Draggable&gt; &lt;/Note
&gt;&lt;/Note&gt;</code></pre></div></div>
<p>Note: this is not how any of your render methods would be, this is just an illustration of how the output might appear to help conceptualize where <em>Draggable</em> fits into the picture.</p>
<h2 style="background-color: #FBF3DB;">Delete</h2>
<p>Delete is fairly straightforward, you would have some clickable element assigned a callback that would be passed up to trigger a delete. I used some <a href="https://fontawesome.com/start">font-awesome free webfont css</a> icons. <em>Note: alternatively you can use <a href="https://github.com/FortAwesome/react-fontawesome">react-fontawesome</a></em></p>
<div class="code-block"><div class="code-header"><span class="code-lang">HTML</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-html">&lt;i onClick=&quot;{this.handleDeleteClick}&quot; className=&quot;fa fa-trash-o&quot; /&gt;</code></pre></div></div>
<h3>Accessibility</h3>
<p>If you used the line above (essentially an icon that has a javascript delete function onClick) you may have found that you got a bunch of <a href="https://www.a11yproject.com/">a11y</a> errors. These are errors related to accessibility, trying to help developers create code that is compatible with various accessibility technologies such as screen readers. The errors here in particular are:</p>
<ul>
<li><a href="https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/master/docs/rules/no-static-element-interactions.md">no static element interactions</a> if you have an <code>onClick</code> you need to also specify the <code>role</code> for click. Is it a button? A link? Other? There is no way for accessibility tools to determine from the generic element type what the purpose of the click is.</li>
<li><a href="https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/master/docs/rules/interactive-supports-focus.md">interactive supports focus</a> specifies that clickable elements must be able to be tab-able to.</li>
<li><a href="https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/blob/master/docs/rules/label-has-associated-control.md">control has associated label</a></li>
</ul>
<p>Please read these and fix the code based on what you find. You‚Äôll be guided through adding in several attributes to annotate interactive elements in such a way that screen readers can understand how to present them.</p>
<h2 style="background-color: #FBF3DB;">Edit</h2>
<p>There are several ways to implement this. You could have a button that opens up a modal, or you could do in-place editing, switching out the display JSX for an editing box.</p>
<p>Here‚Äôs some tips! For in-place, I would recommend having a boolean in your <strong>local component state</strong>, something like <code>isEditing</code> and then in your render function simply switch out which you are displaying based on that state. üö®¬†Not a global variable, this is state. </p>
<p>Here is a common pattern for having clean and readable <code>render()</code> functions:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span></div><pre><code class="language-jsx">const renderSomeSection =&gt; () {
  if (isEditing)
  {
    return &lt;div&gt;editing!&lt;/div&gt;
  } else {
    return &lt;div&gt;the usual stuff&lt;/div&gt;
  }
}

return (
  &lt;div&gt;
    {renderSomeSection()}
  &lt;/div&gt;
);</code></pre></div></div>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/note-edit-1767548477530.png" alt="note-edit.png"></p>
<h3>Markdown</h3>
<p>For markdown support in the main text portion of the note, you can use the <a href="https://github.com/remarkjs/react-markdown">react-markdown</a> package.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span></div><pre><code class="language-jsx">import ReactMarkdown from &#39;react-markdown&#39;;

// then just use something like this where you need it!
&lt;ReactMarkdown&gt;{props.note.text || &#39;&#39;}&lt;/ReactMarkdown&gt;;</code></pre></div></div>
<p>Once you have this working you can test with some markdown syntax!</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span></div><pre><code class="language-jsx">{
 0: {
   title: &#39;testing&#39;,
   text: &#39;![](http://i.giphy.com/gyRWkLSQVqlPi.gif)&#39;,
   x: 400,
   y: 12,
   zIndex: 10,
 },
 1: {
   title: &#39;headings&#39;,
   text: &#39;# large &#39;,
   x: 300,
   y: 300,
   zIndex: 20,
 }
}</code></pre></div></div>
<h2 style="background-color: #FBF3DB;">Part 1 testing</h2>
<p>Ok, at this point you should have an app where you can add notes, move them around, edit them, but when you reload the page it all disappears. Test it out, make sure it all works before you move on!  You have a working SINGLE USER mode, essentially.</p>
<p>üôè¬†Recommendation: Do <strong>not</strong> start part 2 until part 1 is fully working! </p>
<h2 style="background-color: #FBF3DB;">Push it!</h2>
<p>üêô Before we continue let‚Äôs make sure we‚Äôve committed and pushed everything. </p>
<div class="code-block"><div class="code-header"><span class="code-lang">powershell</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-powershell">git commit
git push</code></pre></div></div>
<h1 style="background-color: #DDEBF1;">Part 2 (where we add in persistent storage)</h1>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/react-notes-architecture-1767548477530.jpg" alt=""></p>
<p>Now that we have a working stand-alone app, we should connect it to backend to make it cool and collaborative, MULTI-USER and COLLABORATIVE! We need persistent storage to enable our notes to not go away on reload and to synchronize the notes across different instances of the app.</p>
<p>One way to add persistent storage is to use a backend as a service (BAAS) platform. Firebase is one such platform that provides a JSON based database (<a href="https://firebase.google.com/docs/database/">Firebase Realtime Database</a>) that has some nice realtime properties. For instance you can subscribe to change events on collections of objects. Can we use Firebase with our React app? You bet!</p>
<p><em>Note: we‚Äôll be using Firebase Realtime Database for this rather than the newer Cloud Firestore, although both would work for our purposes.</em></p>
<h2 style="background-color: #FBF3DB;">Let‚Äôs add Firebase as a Feature</h2>
<p>üöÄ¬†Create &amp; checkout a new <code>add_firebase</code> feature branch for our work on part 2!</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><div class="code-block"><div class="code-header"><span class="code-lang">bash</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-bash">git checkout -b add_react</code></pre></div></div></div>
<h2 style="background-color: #FBF3DB;">Reminder of specs</h2>
<ul>
<li>Notes App:<ul>
<li>Add a note:<ul>
<li>can either be a single title input + create button</li>
<li>or a modal if you prefer with all fields</li>
</ul>
</li>
<li>Delete a note</li>
<li>Move a note in x, y<ul>
<li>optionally in z <em>(zIndex)</em></li>
</ul>
</li>
<li>Edit a note<ul>
<li>title, content</li>
</ul>
</li>
<li>Notes:<ul>
<li>have title and content</li>
<li>display with some formatting</li>
</ul>
</li>
<li><strong>Persists all changes to Firebase in realtime</strong></li>
<li><strong>Updates based on Firebase events</strong></li>
</ul>
</li>
</ul>
<h2 style="background-color: #FBF3DB;">Firebase</h2>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/firebase-logo-1767548477530.png" alt=""></p>
<p>üöÄ Create an account and new project at <a href="https://firebase.google.com/">firebase.google.com</a> and start a new project!</p>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/firebase-name-1767548477531.jpg" alt=""></p>
<p>üöÄ In your new project start a <code>Realtime Database</code></p>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/screenshot-2025-04-18-at-9-1767548477531.png" alt="Screenshot 2025-04-18 at 9.39.07‚ÄØAM.png"></p>
<p>üöÄ Enable Realtime Database with public access</p>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/screenshot-2025-04-18-at-9-1767548477531.png" alt="Screenshot 2025-04-18 at 9.40.54‚ÄØAM.png"></p>
<p>By default Firebase only allows authenticated users access to the realtime database, unless you open it up.</p>
<p>The test mode ACL (access control list) only gives you 30 days. You can override it or set it to last through finals! </p>
<div class="code-block"><div class="code-header"><span class="code-lang">JSON</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span></div><pre><code class="language-json">{
  &quot;rules&quot;: {
    &quot;.read&quot;: true,
    &quot;.write&quot;: true
  }
}</code></pre></div></div>
<p>For now we aren‚Äôt going to use authentication, but you can configure your app permissions to allow public read/write while testing.</p>
<p>You can see other <a href="https://firebase.google.com/docs/database/security/quickstart#sample-rules">sample rules</a>, but for now public is what we will use.</p>
<p>Note: it is extra credit to add authentication for users to your app and not just allow anybody to post notes.</p>
<p>üöÄ Let‚Äôs add the firebase js library to your project:</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><div class="code-block"><div class="code-header"><span class="code-lang">bash</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-bash">npm install firebase</code></pre></div></div></div>
<p>üöÄ Now go to your <em>Project Overview</em> page -&gt; <em>Add Firebase To Your App</em></p>
<p>You‚Äôll need to grab the <code>config</code> part that looks something like (grab the whole object):</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span></div><pre><code class="language-jsx">// Set the configuration for your app
// TODO: Replace with your project&#39;s config object
var config = {
  apiKey: &#39;&lt;your-api-key&gt;&#39;,
  authDomain: &#39;&lt;your-auth-domain&gt;&#39;,
  databaseURL: &#39;&lt;your-database-url&gt;&#39;,
  storageBucket: &#39;&lt;your-storage-bucket&gt;&#39;
  projectId: &#39;&lt;your-project-id&gt;&#39;
};
firebase.initializeApp(config);

// Get a reference to the database service
const database = firebase.database();</code></pre></div></div>
<p>Now the question is where shall we put all the various firebase related stuff? How about an javascript <a href="https://www.sitepoint.com/understanding-es6-modules/">module</a> of its own! The idea here is to create a wrapper module with several helpful functions that talk to firebase for us. Think of this as making your own little library of firebase related methods - fact we‚Äôll just abstract it out into something we‚Äôll consider our datastore.</p>
<p>üöÄ Create a file, <code>datastore.js</code> (not .jsx since it is not a component) in a <code>src/services</code> directory. And since we‚Äôre using <code>npm</code> to fetch the firebase SDK for us, here is how we would import it to get started. </p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div><pre><code class="language-jsx">import firebase from &#39;firebase/compat/app&#39;;
import &#39;firebase/compat/database&#39;;
// ^ we are using compat notation here as the new firebase 9 api is a mess and i kinda hate it</code></pre></div></div>
<p>My recommendation is to put all your firebase functions in this file and export them. We briefly talked about js modules. Easiest way to make this module is to simply export every public function:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div><pre><code class="language-jsx">export function onNotesValueChange(callback) {
  //do something here
  //callback() when done
}

// and likewise: import { onNotesValueChange } from &#39;../services/datastore.js&#39;
// to import</code></pre></div></div>
<p>Hey, what‚Äôs this <code>onNotesValueChange</code> function?! Just something that might help!</p>
<p>You may also be wondering about the <code>apiKey</code> and putting that directly in your code. That is indeed not ideal. However, our app is a frontend only app, we may be starting our dev server with <code>npm run dev</code> but our app is just some javascript that runs in the browser. Which means we can‚Äôt use environment variables or anything like that! Also, note that the key we have above is just an API key. This identifies our app to firebase but it doesn‚Äôt necessary grant it any privileges. We‚Äôll see shortly that Firebase wants users to be authenticated, and you will have control over what data is read/write access to your data if you did that.</p>
<p>Once you are ready to use these new functions you can just import it wherever you need it. In particular you would want to import these functions in your top level component where you have your note state related callbacks.</p>
<p><em>Note: if the linter complains about using default it will stop as soon as you add the other functions you‚Äôll probably need here, such as <code>updateNote</code>, etc.</em></p>
<h2 style="background-color: #FBF3DB;">Data Structure</h2>
<p>Firebase stores everything as JSON ‚Äî in fact the whole thing can be thought of as a JSON tree. This works pretty well with how we‚Äôve already been thinking of our notes app data-structures. Everything we needed we stored in a Map, which essentially is a javascript object called notes, with individual notes underneath it stored by key. We created our own key but now Firebase will just handle all the data storage for us. All we need to do is figure out how.</p>
<p>Here‚Äôs what our data might look like in firebase:</p>
<p><img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/lab-3-react-notes/assets/lab3-firebase-1-1767548477531.png" alt="Lab3-firebase.png"></p>
<h2 style="background-color: #FBF3DB;">Reading From Firebase</h2>
<p>Firebase‚Äôs realtime database is based on subscribing to events! This should sound familiar.</p>
<p>In our case, since we are storing the full state of our notes in a top level notes state object, we should subscribe to the on value change Firebase event on all of notes. This isn‚Äôt always the best, in most cases you actually want to subscribe to things lower down in the tree. For our app with a single board of notes though, we might as well subscribe to all the displayed notes.</p>
<p>Here‚Äôs some <a href="https://firebase.google.com/docs/database/web/retrieve-data#value_events">documentation</a>. For all code sample remember you want ‚Äú<strong>Web namespaced API</strong>‚Äù</p>
<p>What we‚Äôll want to do is at some point early on subscribe to <code>value</code> events on some top level key. You can use <code>notes</code> for now, but if you want to do the extra credit of multiple boards and authentication, this would be unique for a particular <em>noteboard</em>. So you can subscribe to multiple namespaces or root keys. This is a listener that will trigger the given callback function with a new snapshot of the tree every time a value changes.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span></div><pre><code class="language-jsx">firebase
  .database()
  .ref(&#39;notes&#39;)
  .on(&#39;value&#39;, function (snapshot) {
    const newNoteState = snapshot.val();
    // do something with new note state
    // pass the state to a CALLBACK MAYBE?
  });</code></pre></div></div>
<p>In our React App where is the right place to initiate retrieving values?  You‚Äôll want to create a subscription to the value change event.  This is import, this needs to be event driven, and not a call that reads the database 1 time.  </p>
<p>Let‚Äôs try <code>useEffect</code>! remember the empty <code>[]</code> as the dependency!  </p>
<p>Your hook callback function might look something like this:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div><pre><code class="language-jsx">firebasedb.onNotesValueChange((notes) =&gt; {
  this.setState({ notes: notes });
});</code></pre></div></div>
<p>To summarize, your <em>App</em> will subscribe to <code>value</code> events on a Firebase database reference (<code>ref</code>). Whenever a note is updated in Firebase it will trigger the callback you provided. Your callback will take this <code>snapshot</code> of data and set your React <code>notes</code> state to the new notes object! Nice, a seamless retrofit. We replace the ENTIRE set of notes, with a new set!</p>
<h2 style="background-color: #FBF3DB;">Writing Data To Firebase</h2>
<p>We have a few methods so far that set state:</p>
<ul>
<li>create new note</li>
<li>update note</li>
<li>delete note</li>
</ul>
<p>We‚Äôve been using Immer <code>produce</code> methods for our state changes, but now we need to push our note state up to Firebase rather than dealing with it locally. What we are going to do is instead of running a <code>setState</code> on our local App component <code>notes</code> state, we are instead going to just push our changes up to Firebase! Then Firebase will essentially return a new notes state for us via the stuff we did above.</p>
<p>Let‚Äôs write these functions in our firebase module to do these ops.</p>
<p>Here are the docs for <a href="https://firebase.google.com/docs/database/web/save-data">saving data in Firebase</a>. Remember we are using compat or Web Version 8 namespaced firebase, not version 9 modular syntax. </p>
<p>The basic idea is that we get our database reference like above (we could save the reference globally within our firebase module also), and then either we <code>push</code> a new note onto it, or we use <code>update</code> to change some fields, or we call <code>remove</code> on it.</p>
<p>Since we already have access to the <code>id</code> which is the <code>key</code> for each object in our <code>notes</code> reference. It should be as simple as:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-jsx">firebase.database().ref(&#39;notes&#39;).child(id).remove(); // update similarly
// ref(&#39;notes&#39;).push(newNote) doesn&#39;t take an id, but returns a new auto-generated one</code></pre></div></div>
<p>As we refactor our code we may find that we don‚Äôt need to use Immer,  we‚Äôll let firebase do any updates and any changes will then push down an entire new state for us!  However, don‚Äôt forget about our buddy Immer, we‚Äôll be using it in later assignments. </p>
<h2 style="background-color: #FBF3DB;">That‚Äôs Pretty Much It</h2>
<p>Test it out! Open multiple browsers and see how adding and moving notes in one instantly reflects in the other. Pretty cool!  ‚ö†Ô∏è¬†DO NOT FORGET TO TEST WITH MULTIPLE BROWSER WINDOWS THAT IS THE WHOLE POINT.</p>
<h2 style="background-color: #FBF3DB;">Merge your Branch!</h2>
<p>And don‚Äôt forget to merge your <code>add_firebase</code> branch into main! </p>
<p>Now try some extra credit!  And if you do, make branches for each feature and merge them in. Do the git feature flow! </p>
<h2 style="background-color: #FBF3DB;">Optional Cypress End2End and Component testing</h2>
<p>There is a test suite written for this assignment. It makes some assumptions:</p>
<ul>
<li>input for adding notes has classname: <code>noteinput</code></li>
<li>each note has a class <code>note</code> and an <code>h1</code> with the title</li>
<li>edit button has an aria label <code>aria-label=edit</code></li>
<li>save button has an aria label <code>aria-label=done-editing</code></li>
<li>delete button has an aria label <code>aria-label=delete</code></li>
<li>that your firebase configs are in <code>src/services/datastore.js</code></li>
</ul>
<p>It is completely optional to utilize this test, but it can be helpful as long as you do the above.  You can find the test itself in: <code>cypress/e2e/test.cy.js</code> and to run it all you have to do is:</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><div class="code-block"><div class="code-header"><span class="code-lang">bash</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span></div><pre><code class="language-bash">npm install cypress -D 
npx cypress run

# or if you want interactive mode

npx cypress open</code></pre></div></div></div>
<p><em>note: you may need to adjust the url in cypress.config.js</em></p>
<h3>To Turn In</h3>
<ul>
<li>üëâ¬†The GitHub assignment Issue will be considered your submission! <strong>To officially turn it in, please comment on the Issue in the repository when you have completed the assignment and mark it Closed.</strong></li>
<li>üôè¬†In your comment please include:<ul>
<li><strong>link to deployed hosted version of the page (render.com)</strong></li>
<li>brief summary of what worked and what didn‚Äôt</li>
<li>remember you must cite external sources when you include other people‚Äôs code, chatGPT, etc</li>
</ul>
</li>
<li>App should have all the minimal functional specs<ul>
<li>have at least an App and Note component</li>
<li>ability to add notes to board</li>
<li>Notes should:<ul>
<li>display title</li>
<li>display content</li>
<li>be draggable</li>
<li>be editable</li>
<li>be deletable</li>
<li>App should have at least the minimal styling of the mockups</li>
</ul>
</li>
</ul>
</li>
<li>submission comment should include:<ul>
<li>a couple sentence description about what you did</li>
<li>and what worked / didn‚Äôt work</li>
<li>any extra credit attempted</li>
</ul>
</li>
</ul>
<h3>Extra Credit</h3>
<p><em>always mention your extra credit in your submission comment</em></p>
<ul>
<li>Some method of note organization such as show-all.</li>
<li>Come up with a way to deal with zIndex sorting:<ul>
<li>when you drag your note does it go above or behind?</li>
<li>can you pop your note to the front when it is dragged?</li>
<li>reorder zIndex in other ways</li>
</ul>
</li>
<li>Resizable notes</li>
<li>Undo feature</li>
<li>Support multiple note boards. This could be implemented by adding route handling to your App where <a href="http://localhost:8080/boards/:id">http://localhost:8080/boards/:id</a> would load the particular board references by the id in the url.</li>
<li>Add in authentication with Firebase Users. We haven‚Äôt covered authentication but Firebase provides a <a href="https://firebase.google.com/docs/auth/">nice auth api</a>.</li>
<li>Allow users to sign-up and then create and manage multiple boards! Can show list of boards as dropdown or as a meta-board of clickable notes!</li>
<li>Live editing ‚Äì showing which user is editing which note!</li>
<li>Locking a note for others when one person is editing.</li>
<li>Column organization Kanban style.</li>
<li>Filtering.</li>
<li>Upload an image.</li>
<li>be creative! lots of other options and ideas</li>
</ul>

</body>
</html>