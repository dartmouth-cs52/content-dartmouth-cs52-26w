<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      max-width: 85%;
      margin: 0 auto;
      padding: 2rem;
      color: #333;
    }
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      margin-bottom: 0;
    }
    h1 {
      font-size: 2em;
      margin-top: 2rem;
      background-color: #FBF3DB;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      display: inline-block;
    }
    h2 {
      font-size: 1.5em;
      margin-top: 1.5rem;
      background-color: #DDEBF1;
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      display: inline-block;
    }
    h3 { font-size: 1.25em; margin-top: 1rem; }
    /* Heading block wrappers */
    .heading-block { margin: 0; padding: 0; }
    .heading-block h1, .heading-block h2, .heading-block h3 { margin-top: 0; }
    .h1-block { margin-top: 2rem; }
    .h2-block { margin-top: 1.5rem; }
    .h3-block { margin-top: 1rem; }
    p { margin-bottom: 1em; font-size: 16px; }
    ul, ol {
      margin-bottom: 1em;
      padding-left: 1.5em;
      list-style-position: outside;
    }
    ul { list-style-type: disc; }
    ol { list-style-type: decimal; }
    li {
      margin-bottom: 0.25em;
      display: list-item;
      font-size: 16px;
    }
    ul ul, ol ul { list-style-type: circle; }
    ul ul ul, ol ul ul { list-style-type: square; }
    ol ol { list-style-type: lower-alpha; }
    ol ol ol { list-style-type: lower-roman; }
    code {
      background: #f6f8fa;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 85%;
    }
    pre {
      background: #f6f8fa;
      padding: 1em;
      border-radius: 6px;
      overflow-x: auto;
      margin-bottom: 1em;
    }
    pre code {
      background: none;
      padding: 0;
      font-size: 100%;
    }
    /* Code block with header and line numbers */
    .code-block {
      background: #1e1e1e;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
    }
    .code-block .code-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      background: #161616;
      border-bottom: 1px solid #333;
    }
    .code-block .code-lang {
      color: #9ca3af;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .code-block .code-body {
      display: flex;
      padding: 1rem 0;
    }
    .code-block .line-numbers {
      display: flex;
      flex-direction: column;
      padding: 0 1rem 0 1rem;
      text-align: right;
      user-select: none;
      color: #6b7280;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 1rem;
      line-height: 1.625;
    }
    .code-block .line-numbers .line-number {
      display: block;
    }
    .code-block pre {
      flex: 1;
      background: transparent;
      margin: 0;
      padding: 0 1rem 0 0;
      overflow-x: auto;
    }
    .code-block pre code {
      color: #d4d4d4;
      font-size: 1rem;
      line-height: 1.625;
    }
    .terminal-block {
      background: #1e1e1e;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1em;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .terminal-block .terminal-header {
      background: linear-gradient(180deg, #3c3c3c 0%, #2d2d2d 100%);
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid #1a1a1a;
    }
    .terminal-block .terminal-dots {
      display: flex;
      gap: 8px;
    }
    .terminal-block .terminal-dots span {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .terminal-block .terminal-dots span:nth-child(1) { background: #ff5f57; }
    .terminal-block .terminal-dots span:nth-child(2) { background: #febc2e; }
    .terminal-block .terminal-dots span:nth-child(3) { background: #28c840; }
    .terminal-block .terminal-title {
      flex: 1;
      text-align: center;
      color: #9ca3af;
      font-size: 0.8rem;
      font-weight: 500;
      margin-right: 60px;
    }
    .terminal-block pre {
      background: transparent;
      margin: 0;
      padding: 1rem;
      font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .terminal-block pre code {
      background: transparent;
      color: #d1d5db;
      padding: 0;
      font-size: inherit;
      font-family: inherit;
    }
    .terminal-block .terminal-prompt {
      color: #4ade80;
      user-select: none;
    }
    blockquote {
      border-left: 4px solid #ddd;
      margin: 1em 0;
      padding-left: 1em;
      color: #666;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1em;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.75em;
      text-align: left;
    }
    th {
      background: #f6f8fa;
      font-weight: 600;
    }
    a {
      color: #0969da;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    img {
      max-width: 100%;
      height: auto;
    }
    .callout {
      background: #f7f6f3;
      padding: 1em;
      border-radius: 6px;
      display: flex;
      gap: 0.75em;
      margin-bottom: 1em;
    }
    .callout-emoji {
      font-size: 1.25em;
    }
    .alert {
      padding: 1rem;
      border-radius: 6px;
      border-left: 4px solid;
      margin-bottom: 1em;
      display: flex;
      gap: 0.75rem;
    }
    .alert-info {
      background: #dbeafe;
      border-left-color: #3b82f6;
    }
    .alert-warning {
      background: #fef3c7;
      border-left-color: #f59e0b;
    }
    .alert-error {
      background: #fee2e2;
      border-left-color: #ef4444;
    }
    .alert-success {
      background: #d1fae5;
      border-left-color: #10b981;
    }
    .alert-note {
      background: #f3f4f6;
      border-left-color: #6b7280;
    }
    .alert::before {
      content: '';
      font-size: 1.25em;
    }
    .alert-info::before { content: 'ğŸ’¡'; }
    .alert-warning::before { content: 'âš ï¸'; }
    .alert-error::before { content: 'ğŸš¨'; }
    .alert-success::before { content: 'âœ…'; }
    .alert-note::before { content: 'ğŸ“Œ'; }
    .checklist-item {
      display: flex;
      align-items: start;
      gap: 0.75rem;
      margin-bottom: 0.5em;
    }
    .checklist-item input[type="checkbox"] {
      margin-top: 0.375rem;
      width: 1rem;
      height: 1rem;
      cursor: not-allowed;
    }
    .checklist-item input[type="checkbox"]:checked + span {
      text-decoration: line-through;
      color: #9ca3af;
    }
    .file-tree {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
    }
    .file-tree::before {
      content: attr(data-title);
      display: block;
      background: #f3f4f6;
      color: #6b7280;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid #e5e7eb;
    }
    .file-tree pre {
      background: transparent;
      color: #374151;
      margin: 0;
      padding: 1rem;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    .video-embed {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin-bottom: 1em;
      border-radius: 6px;
    }
    .video-embed iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .file-download {
      background: #f6f8fa;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
      padding: 1em;
      margin-bottom: 1em;
    }
    .file-download a {
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      color: #0969da;
      font-weight: 500;
    }
    .file-download a::before {
      content: 'ğŸ“';
    }
    .page-link-block {
      display: block;
      width: 100%;
      padding: 0.5rem;
      margin: 0 -0.5rem 1em -0.5rem;
      border-radius: 0.25rem;
      transition: background-color 0.15s;
      cursor: pointer;
    }
    .page-link-block:hover {
      background-color: #f3f4f6;
    }
    .page-link-block a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #111827;
      font-weight: 600;
      text-decoration: underline;
    }
    .page-link-block a:hover {
      text-decoration: underline;
    }
    .page-link-block a::before {
      content: 'ğŸ“„';
      font-size: 1rem;
      flex-shrink: 0;
    }
    .profile-card {
      display: flex;
      flex-direction: column;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
      background: white;
      width: 100%;
    }
    .columns .profile-card {
      max-width: 100%;
    }
    .profile-card img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      background: #f3f4f6;
      margin: 0;
    }
    .profile-card > div {
      padding: 1rem;
    }
    .profile-card strong {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }
    .profile-card em {
      display: block;
      font-size: 14px;
      font-style: normal;
      color: #6b7280;
      margin-top: 0.25rem;
    }
    .embed-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin-bottom: 1em;
      border-radius: 6px;
      border: 1px solid #e1e4e8;
    }
    .embed-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .columns {
      display: grid;
      gap: 1.5rem;
      margin-bottom: 1em;
    }
    .columns[data-columns="2"] {
      grid-template-columns: repeat(2, 1fr);
    }
    .columns[data-columns="3"] {
      grid-template-columns: repeat(3, 1fr);
    }
    .columns[data-columns="4"] {
      grid-template-columns: repeat(4, 1fr);
    }
    .column {
      min-height: 50px;
    }
    @media (max-width: 768px) {
      .columns {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/sa-state-management-short-assignment/assets/untitled-1767548385857.png" alt="Untitled">
<div class="heading-block h2-block"><h2>Overview</h2></div>
<p>React StarterPack + <a href="https://zustand-demo.pmnd.rs/">Zustand</a></p>
<p>For this workshop weâ€™re just going to add Zustand to our starter pack and our YouTube video Short Assignment!</p>
<p>Zustand is a fancy state management system that weâ€™ll be using to build our various next assignments. It will allow us to simplify our code and have a global state in our app with fewer callbacks!  It is a successor to Redux, which is a popular state management tool you may have heard of. Zustand follows the same <a href="https://docs.pmnd.rs/zustand/guides/flux-inspired-practice">Flux pattern</a> but simplifies it significantly.  Instead of Actions, ActionCreators, Dispatch, Reducers, createAsyncThunk, createSlice, etc,  we have a store, and action functions, well and a bit of slices. </p>
<p></p>
<p>ğŸ’»ï¸ run in Terminal</p>
<p>ğŸš€ a step to not forget</p>
<div class="heading-block h2-block"><h2>Part 1:  starterpack update</h2></div>
<p>ğŸš€ Weâ€™re going to keep working on your <strong>frontend-starterpack</strong> for this assignment. </p>
<p>So just dig up that repo and work there! At this point you should have a starterpack that has vite+babel+eslint+sass+react+reactrouter. Remember to just push your new stuff to this. For grading weâ€™ll know which commits to look at. You want to keep building this up.</p>
<p>Now weâ€™re going to add in Zustand to your personal starter repository so now youâ€™ll have vite+babel+eslint+sass+react+reactrouter+zustand! Wow.</p>
<div class="heading-block h2-block"><h2>Branch it</h2></div>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><pre><code class="language-bash">git checkout -b add_state_management</code></pre></div>
<div class="heading-block h2-block"><h2>Zustand</h2></div>
<p>ğŸš€ Install zustand node module</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><pre><code class="language-bash">npm install zustand</code></pre></div>
<p>Zustand is a general state management paradigm that does not necessarily need to be tied to React. But together they are an unstoppable force for clean web development. </p>
<div class="heading-block h2-block"><h2>What is Zustand?</h2></div>
<blockquote>
<p>Zustand is a predictable state container for JavaScript apps that is small, fast, and scalable. It is based on simplified flux principles and has a hook-based API, and involves a lot less boilerplate code than Redux and similar libraries for managing React states.</p>
</blockquote>
<p>Zustand has a few main concepts that we will tackle.</p>
<ul><li><strong>Store</strong>: the entire state of your app is stored in an object tree inside a single store.</li><li><strong>Action Functions</strong>: the only way to change the state tree ğŸŒ³&nbsp;is to run a set function that lives in the store.</li></ul>
<p>This is a simplification of the flux pattern we have discussed, and a welcome one at that!</p>
<div class="heading-block h3-block"><h3>Actions</h3></div>
<p>Remember how our state should be treated as if it is immutable (read-only)? Actions are the way to trigger new states. In plain React we would run a <code>setState</code> based on events passed up through callbacks. With Zustand,  we can still use local react component state for certain things, but whenever we need a far reaching state change we will use store actions instead.</p>
<p>For instance an action could look like the following.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">(someActionPayload) =&gt; set((state) =&gt; ({ someKey: someActionPayload }));</code></pre></div></div>
<p>Actions ensure that the state is set properly.</p>
<div class="heading-block h3-block"><h3>Store</h3></div>
<p>The Store is a way to store the global state for your app. So far for the React apps that we have built we have had local component state for a few of our smart components, and often have had a top level state inside of our App component. Having your app state in a single state tree has lots of positive benefits. The store is initialized in your top level <code>index.jsx</code> file.</p>
<div class="heading-block h2-block"><h2>Code</h2></div>
<p>Letâ€™s wire this all together, it may seem a bit tricky at first but weâ€™ll work though it!</p>
<div class="heading-block h3-block"><h3>File Structure</h3></div>
<p>ğŸš€ Create a file structure to store our actions and reducers.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">mkdir src/store src/components</code></pre></div></div>
<p>Weâ€™re going to create an extensible structure so there might be a little bit extra boilerplate, but not to worry itâ€™ll all make sense.</p>
<div class="heading-block h3-block"><h3>Store</h3></div>
<p>The Zustand store is the main module responsible for bringing it all together. The store contains our state data and contains the functions that generate new state all in one neat package. </p>
<p>With Javascript if you have a directory with multiple files and an <code>index.js</code> file you can import it by the directory name: <code>import ./store</code> weâ€™ll use this to create a module store with potentially multiple files in it. </p>
<p>For this simple example weâ€™re going to have 1 global store. When a store gets too large folks will sometimes split it up either into multiple stores (when no actions need to change data across stores, or into a slices pattern when they are more interconnected. Weâ€™ll use and learn about slices later but for now letâ€™s just set up on simple store. </p>
<p>ğŸš€&nbsp;Create a super simple store <code>store/index.js</code>:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span></div><pre><code class="language-javascript">import { create } from 'zustand';
import { devtools } from 'zustand/middleware';

const useStore = create(
  devtools((set) =&gt; {
    return {
      count: 0,
      increment: () =&gt; set((state) =&gt; ({ count: state.count + 1 })),
      decrement: () =&gt; set((state) =&gt; ({ count: state.count - 1 })),
    };
  }),
);

export default useStore;</code></pre></div></div>
<p>Ok, what did we just?   Weâ€™re using Zustandâ€™s <code>create</code> function and we pass in a function that takes <code>set</code> as an argument and returns an object with multiple keys.  This is our store!  We have <code>count</code> which is a value and two functions which we will call actions.  Super simple. </p>
<div class="heading-block h3-block"><h3>DevTools</h3></div>
<p>Wait, before we go on, it would be really lovely to have some devtools that can show us the state of the store, right?  </p>
<p>Notice in our store we have a small bit of middleware we snuck in there. A function called devtools.  This function makes our store accessible to some devtools! </p>
<p>Great, letâ€™s all download and install <a href="https://chromewebstore.google.com/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd">ReduxDevtools</a>!  </p>
<blockquote>
<p>â€œWait Redux? You promised we wouldnâ€™t be doing Redux anymore?!â€</p>
</blockquote>
<p>True, but Zustand maintains a store that turns out to be compatible with Redux and the Redux devtools work pretty seamlessly with it, so weâ€™ll do that. </p>
<p>âœ”ï¸ Now you can open redux dev tools in your browser and confirm that the redux store is initialized:</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/sa-state-management-short-assignment/assets/confirm-store-1767548385857.jpg" alt="">
<div class="heading-block h2-block"><h2>Connected components</h2></div>
<p>Now we have the basics done, we should create some connected components. A connected component is one that is literally connected to the store for some bit of state.</p>
<p>Letâ€™s create some components that make use of our setup! These will be toy examples, and donâ€™t particularly need app state management. But theyâ€™ll demonstrate the various wirings needed for setting up a much more complicated app.</p>
<div class="heading-block h3-block"><h3>Counter</h3></div>
<p>ğŸš€ Letâ€™s create a component for displaying our state. Create a new file <code>counter.jsx</code></p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span></div><pre><code class="language-javascript">import React from 'react';
import useStore from '../store';

function Counter(props) {
  const count = useStore((state) =&gt; state.count);
  return &lt;div&gt;Current Count: {count}&lt;/div&gt;;
}

export default Counter;</code></pre></div></div>
<p>Some things to note about this component:</p>
<ol start="1"><li><code>useStore</code>. It turns out that the Zustand store is really just a hook! This hook gives you access to the store and from there either the state or the action functions. In this case, we only want the count.</li><li><code>count</code>. Check it, what we are doing is selecting a small bit of the data, not the whole thing. This means that this component will be rerendered when the store <code>state.count</code> state is updated, but it will ignore any other data that wasnâ€™t specified in this <em>selector</em> function.</li></ol>
<p>ğŸš€ Add <code>&lt;Counter /&gt;</code> to the render method of one of the components that are currently displaying like <em>Welcome</em></p>
<p>You should now see it rendering with a value of 0. This value is coming from the default value in our reducer!</p>
<div class="heading-block h3-block"><h3>Controls</h3></div>
<p>ğŸš€ Letâ€™s create one more component. Oof! This time itâ€™ll just be a couple of buttons to call some actions. Make one last file: <code>controls.jsx</code>.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span></div><pre><code class="language-javascript">import React from 'react';
import useStore from '../store';

function Controls(props) {
  const increment = useStore((state) =&gt; state.increment);
  const decrement = useStore((state) =&gt; state.decrement);

  return (
    &lt;div&gt;
      &lt;button type="button" onClick={increment}&gt;
        +
      &lt;/button&gt;
      &lt;button type="button" onClick={decrement}&gt;
        -
      &lt;/button&gt;
    &lt;/div&gt;
  );
}

export default Controls;</code></pre></div></div>
<p>Some things to note about the this component:</p>
<ol start="1"><li><code>useStore</code>  we use the <code>useStore</code> hook (that we created!) again here to pull out the two action functions.</li><li><code>increment/decrement</code> are the two action functions that we created in the store, here we grab references to them and can then pass them in as onClick handlers.</li></ol>
<p>ğŸš€ Add <code>&lt;Controls /&gt;</code> to the render method of one of the components that are currently displaying like <em>Welcome</em></p>
<p>Note that these two components <strong>donâ€™t need to have a common parent</strong>, and you <strong>donâ€™t have to pass around functions in callbacks</strong>. In a simple example like this it might not make much of a difference, we could have put the counter into the local component state of the parent. However if you had multiple levels of components the callback tracking would get difficult.</p>
<p>ğŸ§˜&nbsp;Weâ€™ll do much more of this type of app state management, so if this is a little confusing now donâ€™t worry!</p>
<div class="heading-block h2-block"><h2>Debugging</h2></div>
<p>Last thing! Try opening up the Redux Chrome DevTools and play with the timeline to move the state forward and back.</p>
<p>Play with the <em>slider</em> and note how you can export and import state. Imagine how powerful that would be if we could just save the whole state of a very complex app!</p>
<p>â“But there is a question here.  Why are all the actions showing up as â€œanonymousâ€?!?</p>
<p>âœ”ï¸&nbsp;Yeah, that is because the redux devtools want a specific String name for the action. We can add that in like so:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span></div><pre><code class="language-javascript">// careful with this syntax - if 2nd arg is true it will replace all state rather than merge
increment: () =&gt; set((state) =&gt; ({ count: state.count + 1 }), false, 'count/increment'),
decrement: () =&gt; set((state) =&gt; ({ count: state.count - 1 }), false, 'count/decrement'),</code></pre></div></div>
<p>The zustand <code>set</code> function takes some extra arguments! </p>
<ol start="1"><li>Argument 1 (what we have used so far) is the state updater function that returns new state.</li><li>Argument 2 is a boolean that determines whether the state should be merged (false is default and almost always desired) or if it should be replaced (useful for resetting everything). Leave this false unless you know what you are doing.</li><li>Argument 3 is a String name for the action.</li></ol>
<p>Replace the lines you have in your <code>store/index.js</code>, refresh the page, and now in devtools you should see the names of the actions!</p>
<p>â“&nbsp;Should you always name your actions?  Yes! Youâ€™ll thank yourself later. </p>
<div class="heading-block h2-block"><h2>Immer</h2></div>
<p>â“&nbsp;Ok, this is all fine, but what if we have complex state, weâ€™ve heard tell that immutability of state is important, but in the above examples what is preventing us from mutating state?  </p>
<p>Well nothing,  if you did <code>set((state) =&gt; { state.count++; }</code> you would get some eslint warnings, but it would, at this stage, work.  However, that is only because count is a primitive, if count was an object and you were then modifying some property inside it, then the page may not update predictably or rerender as you desire, especially if there are lots of changes. </p>
<p>â“How might we guarantee that we donâ€™t make an assignment mistake and always treat state as immutable?  </p>
<p>GREAT QUESTION!  Easy!  We can use <a href="https://immerjs.github.io/immer/">Immer</a>!  Turns out Zustand supports it out of the box. ğŸ&nbsp; Just have to: </p>
<p><code>npm install immer</code></p>
<p>ğŸš€&nbsp; Add Immer to your store like so:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span><span class="line-number">30</span><span class="line-number">31</span><span class="line-number">32</span></div><pre><code class="language-javascript">import { create } from 'zustand';
import { devtools } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

const useStore = create(
  devtools(
    immer((set) =&gt; {
      return {
        count: 0,
        // careful with this syntax if 2nd arg is true it will replace all state rather than merge
        increment: () =&gt;
          set(
            (draftState) =&gt; {
              draftState.count += 1;
            },
            false,
            'count/increment',
          ),
        decrement: () =&gt;
          set(
            (draftState) =&gt; {
              draftState.count -= 1;
            },
            false,
            'count/decrement',
          ),
      };
    }),
  ),
);

export default useStore;</code></pre></div></div>
<p>â—Shoot, Iâ€™m getting a nasty <code>eslint</code> error about reassigning a parameter!  </p>
<p>Well technically, you are assigning to a property of a parameter, so that isnâ€™t as bad.  </p>
<p>ğŸš€&nbsp;Add the following to your <code>.eslintrc.json</code> file to make it go away. </p>
<p>This says that we should still error if we were to reassign the parameter completely like <code>function foo(param) { param = somethingesle }</code> but it wonâ€™t error if it is a property of the parameter like ``function foo(param) { param.property = soemthing }` </p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">"no-param-reassign": [ "error", { "props": false } ],</code></pre></div></div>
<p>â“&nbsp;Ok, but can you explain?  What happened with <code>draftState</code> and what did we change?!</p>
<p>âœ”ï¸&nbsp;Sure!  With the Immer middleware (notice how we now have <code>devtools</code> and <code>immer</code> middleware in our <code>create</code>) instead of passing in the current store state to our action functions, we instead get passed in a draftState which immer then creates a new state out of.  SO!  We can now simply mutate draftState and are always guaranteed that our actual store state wonâ€™t be mutated because Immer is great. AND we didnâ€™t even need the Immer <code>produce</code> function, as essentially our entire store is automatically wrapped in Immer with this middleware.  Nifty keen! </p>
<p>ğŸ§ª&nbsp;Ok test it all out, still works great?  Great!  Release it. </p>
<div class="heading-block h2-block"><h2>PR it!</h2></div>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><pre><code class="language-bash">
git commit 
git push origin add_state_management
# then make a PR and merge it in to your main branch!</code></pre></div>
<div class="heading-block h1-block"><h1>Part 2: YouTube!</h1></div>
<p>Currently our React YouTube search app works great, but maybe we can learn some state management and refactor it! If you remember, we had to pass props down multiple levels, can we now use our new State Management Skills to select the video to show in Detail View without having to pass properties down multiple levels and to keep our state beautifully coherent?</p>
<p><a href="http://res.cloudinary.com/dali-lab/video/upload/ac_none,w_800,h_762/v1546203223/cs52/videos-redux.webm">videos-redux.webm</a></p>
<div class="heading-block h2-block"><h2>Prepare the Repo</h2></div>
<p>ğŸ˜± The next part may be a bit scary - weâ€™re going to merge in your new starterpack changes into this repo and itâ€™ll create a bit of confusion. <strong>You can either do the merge and practice fixing merge conflicts, or you can manually try to copy over changes.</strong> The merge conflict way works surprisingly well, but can be a bit scary at first as youâ€™ll have some broken code and youâ€™ll need to pay attention to linting errors and merge conflict markers to fix it. If you need a refresher about git merge resolution see the <a href="https://www.notion.so/ECSA-Git-Map-029087af71764896a7246445074002c0?pvs=21">git-map ec short</a>. You got this, breathe and read the codes. ğŸ‘&nbsp;This is a great exercise as to merge successfully youâ€™ll need to read the codes and understand which lines to pick â€” but I believe in you, you are ready. </p>
<p>ğŸš€ To begin, weâ€™ll create a new branch <code>statemanagement-sa</code> in your react-videos short assignment repo.</p>
<p>Navigate to your repository on the command line and pull in the updates youâ€™ve just made to your starterpack:</p>
<div class="terminal-block"><div class="terminal-header"><div class="terminal-dots"><span></span><span></span><span></span></div><span class="terminal-title">Terminal</span></div><pre><code class="language-bash">cd react-videos-short-assignment-directory
git pull origin main #just in case to make sure you have the latest
git checkout -b statemanagement-sa #create a new branch statemanagement-sa
git pull starter main  #pull in your updated starter code! (this will only work AFTER you have merged in your changes in P1!</code></pre></div>
<p>Hopefully, you should only have major conflicts in your <code>src/index.jsx</code> file. Letâ€™s handle them now!</p>
<p>âš ï¸ If you have conflicts in your <code>package-lock.json</code> do: <code>git checkout --theirs -- package-lock.json</code>. This will choose the entire file from your starterpack.</p>
<p>âš ï¸ If you have conflicts in your <code>package.json</code>, merge them in manually, you will most likely want the union of the two.</p>
<p>ğŸš€ Copy all the code from the HEAD (Current Change) of <code>src/index.jsx</code> or (<code>app.jsx</code> if you had chosen to put it in there) and paste it into its own new file <code>src/components/youtube.jsx</code>. Now go ahead and accept the incoming change.</p>
<ul><li><p>Donâ€™t worry if you lost your HEAD, itâ€™s right here!</p></li></ul>
<p>ğŸš€ To finish off our merge:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span></div><pre><code class="language-javascript">// you'll need to import the YouTube component in index.jsx (or app.jsx)
import YouTube from './youtube';

// and then display the component
&lt;YouTube /&gt;;</code></pre></div></div>
<p>âš ï¸ You may need to do a little bit of cleanup, for instance in <code>app.jsx</code> get rid of the counter and controls components, you wonâ€™t need them. This is a good exercise in going through your code and doing some refactoring. Your linter will help you here, it will tell you things that are undefined or need importing etc.</p>
<ul><li><p>Essentially, all we are doing is making our index.jsx file simply load up the YouTube component â€” you could also have index render app render youtube.</p></li></ul>
<p>ğŸš€ Your linter should tell you that <code>youtube.jsx</code> has a lot of errors. Notice that we moved that code into the component directory so a lot of the import paths are wrong. Youâ€™ll want to fix the paths in those import statements. Remember <code>../</code> is up one directory and <code>./</code> is in the current directory. At this point you should be able to get it to a point where it will build and you can get the main page up and running.</p>
<p>ğŸš€ Donâ€™t forget to run <code>npm install</code> to install any of the new dependencies that were merged into <code>package.json</code>.</p>
<p>ğŸš€ Finish the Merge! Once you have finished handling the conflicts, go ahead and <code>git add</code> and <code>git commit</code> the changes to resolve the conflicts and finish the merge.</p>
<p><em>NOTE: If you are adding zustand to some other existing project and donâ€™t want to merge in the starter repo, you can go through the steps in part 1 to set up the dependencies and store.</em> </p>
<div class="heading-block h2-block"><h2>Store</h2></div>
<p>Ok,  letâ€™s think about the data that we want now.  Letâ€™s summarize what data we want:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span></div><pre><code class="language-javascript">countStore: {
  count: 0;
}

videoStore: {
  list: [];
  selected: {
  }
}</code></pre></div></div>
<p>So we could have:</p>
<ul><li>one big store just like we did in Part 1.  Easy but over time will get confusing.</li><li>we could split this up into 2 completely separate stores, fine, but what if we ever wanted to change something in both, and if we want to see them in the Redux DevTools as one global state?</li><li>we could use a pattern called slices.  This is the <a href="https://docs.pmnd.rs/zustand/guides/slices-pattern">recommended pattern</a> from the Zustand creators, so while we donâ€™t need it at this stage, we might as well introduce it so you know it!</li></ul>
<div class="heading-block h3-block"><h3>Slices</h3></div>
<p>ğŸš€&nbsp;Set up your store to have slices!  </p>
<p>1ï¸âƒ£&nbsp; <code>store/index.js</code> will now import slices and create the store</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span></div><pre><code class="language-javascript">import { create } from 'zustand';
import { devtools } from 'zustand/middleware';
import { immer } from 'zustand/middleware/immer';

import createVideoSlice from './video-slice';
import createCountSlice from './count-slice';

// folks can use slices or multiple stores if they want
const useStore = create(
  devtools(
    immer((...args) =&gt; ({
      videoSlice: createVideoSlice(...args),
      countSlice: createCountSlice(...args),
    })),
  ),
);

export default useStore;</code></pre></div></div>
<p><em>EC question:  what is <code>...args</code> up above?</em> </p>
<p>2ï¸âƒ£&nbsp;Recreate our count store as a slice! <code>store/count-slice.js</code></p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span></div><pre><code class="language-javascript">export default function createCountSlice(set) {
  return {
    count: 0,
    increment: () =&gt;
      set(
        ({ countSlice: draftState }) =&gt; {
          draftState.count += 1;
        },
        false,
        'counter/increment',
      ),
    decrement: () =&gt;
      set(
        ({ countSlice: draftState }) =&gt; {
          draftState.count -= 1;
        },
        false,
        'counter/decrement',
      ),
  };
}</code></pre></div></div>
<p>Note some peculiarities.. We essentially have just taken part of the store creation out into a separate file, yes. BUT we have also used some <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">destructuring syntax</a> to help us only operate on the count slice key we defined in the store. We called our slice <code>countSlice</code> so here we pull that key out AND rename it:  <code>{countSlice: draftState}</code> deconstructs our global state object and pulls out only the <code>countSlice</code> key and renames it to be <code>draftState</code>.  </p>
<p>WHY!??   For clarity! This is so you donâ€™t forget that we are working with Immer on a draft.  If you forget, you may do things that donâ€™t work.  So we remind ourselves by writing clear code! </p>
<p>3ï¸âƒ£&nbsp;Create our videoStore <code>store/video-slice.js</code></p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span></div><pre><code class="language-javascript">export default function createVideoSlice(set) {
  return {
    selected: null,
    list: [],
    selectVideo: (video) =&gt;
      set(
        ({ videoSlice: draftState }) =&gt; {
          draftState.selected = video;
        },
        false,
        'video/selectVideo',
      ),
    setVideos: (videos) =&gt;
      set(
        ({ videoSlice: draftState }) =&gt; {
          draftState.selected = videos[0];
          draftState.list = videos;
        },
        false,
        'video/setVideos',
      ),
  };
}</code></pre></div></div>
<div class="heading-block h2-block"><h2>Connected Components</h2></div>
<p>Letâ€™s see what you remember!</p>
<div class="heading-block h3-block"><h3>VideoListItem</h3></div>
<p>ğŸš€ In <code>components/video_list_item.jsx</code> connect <code>VideoListItem</code> to the store (import <code>useStore</code>) and change the react function <code>props.onVideoSelect(props.video)</code> to now instead grab the <code>videoSlice.selectVideo</code> function from the store. </p>
<p><strong>HINT:</strong> if youâ€™re stuck, use <code>controls.js</code> as an example</p>
<ul><li><p>If youâ€™re stuck++, take a look here</p></li></ul>
<div class="heading-block h3-block"><h3>VideoList</h3></div>
<p>ğŸš€ In <code>components/video_list.jsx</code> remove <code>onVideoSelect={props.onVideoSelect}</code>  from <code>VideoListItem</code>. Yay! We no longer need to pass this function around it lives directly in our store.</p>
<p>ğŸš€ We can also upgrade <em>VideoList</em> to connect to the entire list of videos. Edit <code>video_list.jsx</code> to include the following:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">const videos = useStore(({ videoSlice }) =&gt; videoSlice.list);</code></pre></div></div>
<p><em>Note we donâ€™t have to edit that we map over props.videosâ€¦ cause weâ€™re just naming it the same thing!</em></p>
<ul><li><p>Whole thing in case, but you should really not need this.</p></li></ul>
<div class="heading-block h2-block"><h2>YouTube Component</h2></div>
<p>ğŸš€ Now, we need to connect <code>components/youtube.jsx</code></p>
<ol start="1"><li>Letâ€™s connect <code>YouTube</code> to our store. The only thing this top component now needs is to be able to run the <code>setVideos</code> action.</li><li><strong>Remove ALL top level state</strong>! It isnâ€™t necessary to keep the variables in both the react state and the  store in this situation.</li><li><strong>Remove ALL passed props</strong> from <code>&lt;VideoDetail /&gt;</code> and <code>&lt;VideoList /&gt;</code>, just render them as is.</li><li>Change the search function to simply pass the videos list to <code>setVideos(videos)</code> rather than running any setState. Weâ€™ll stick with using the youtubeSearch api promise like weâ€™ve been doing.</li></ol>
<ul><li><p>Give it a try on your own first!</p></li></ul>
<div class="heading-block h2-block"><h2>VideoDetail</h2></div>
<p>Ok, this one needs access to the bit of store state which is <code>state.videoSlice.selected</code>.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">const video = useStore((state) =&gt; state.videoSlice.selected);</code></pre></div></div>
<p>â“&nbsp;Wait, you did something different there. You donâ€™t have any destructuring assignmentâ€¦ and state is in there?  </p>
<p>ğŸ¤ª&nbsp;Sure thing!  There are many ways to do stuff.  <code>({videoSlice})</code> is an example of destructuring assignment, but here I wanted to show that you can also just dig through the global state object to get at the videoSlice data.  Your preference how you do it. I like the destructuring because I feel it makes things clearer, but you may prefer to always just think of the global state.  Your preference!</p>
<div class="heading-block h2-block"><h2>Debugging</h2></div>
<p>Last thing! Try opening up the Redux Chrome DevTools and play with the timeline to move the state forward and back.</p>
<p>Play with the <em>slider</em> and note how you can export and import state. Imagine how powerful that would be if we could just save the whole state of a very complex app!</p>
<div class="heading-block h2-block"><h2>Release it!</h2></div>
<p><strong>Commit</strong> and <strong>push</strong> your changes to your new state management branch  <code>git push origin statemanagement-sa</code>. No need to merge into main! </p>
<p>ğŸš€&nbsp;You should create a new render site and then select the <code>statemanagement-sa</code> branch instead of <code>main</code> so you can have multiple sites running off of different versions of your code.</p>
<div class="heading-block h1-block"><h1>To Turn In</h1></div>
<ul><li>ğŸ‘‰&nbsp;The GitHub assignment Issue will be considered your submission! <strong>To officially turn it in, please comment on the Issue in the repository when you have completed the assignment and mark it Closed.</strong></li><li>ğŸ™&nbsp;In your comment please include:<ul><li><strong>link to deployed hosted version of the page (render.com)</strong></li><li>brief summary of what worked and what didnâ€™t</li><li>remember you must cite external sources when you include other peopleâ€™s code, chatGPT, etc</li></ul></li><li>include: url to new starterpack render deployed site</li><li>include: url to new react-videos render deployed site from the <code>statemanagement-sa</code> branch</li><li>remember that all your code should lint cleanly</li><li>your youtube searcher should have the same functionality as before, but now with state management!</li></ul>
<div class="heading-block h1-block"><h1>Extra Credit</h1></div>
<ul><li>hmm, as always add in some more data sources, giphy etc (canâ€™t count em twice but if you hadnâ€™t done it before you could now)</li><li>add in zustand persist middleware</li><li>implement undo/redo</li><li>play around with other zustand middleware, including <a href="https://docs.pmnd.rs/zustand/integrations/third-party-libraries">these third-party libraries</a><ul><li><a href="https://github.com/charkour/zundo">https://github.com/charkour/zundo</a></li><li><a href="https://github.com/Albert-Gao/auto-zustand-selectors-hook">https://github.com/Albert-Gao/auto-zustand-selectors-hook</a></li><li><a href="https://github.com/oslabs-beta/Zusty">https://github.com/oslabs-beta/Zusty</a></li></ul></li></ul>
<div class="heading-block h2-block"><h2>Resources</h2></div>
<ul><li><a href="https://zustand-demo.pmnd.rs/">https://zustand-demo.pmnd.rs/</a></li></ul>
</body>
</html>