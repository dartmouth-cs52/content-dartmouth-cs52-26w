<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      max-width: 85%;
      margin: 0 auto;
      padding: 2rem;
      color: #333;
    }
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      margin-bottom: 0;
    }
    h1 {
      font-size: 2em;
      margin-top: 2rem;
      background-color: #FBF3DB;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      display: inline-block;
    }
    h2 {
      font-size: 1.5em;
      margin-top: 1.5rem;
      background-color: #DDEBF1;
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      display: inline-block;
    }
    h3 { font-size: 1.25em; margin-top: 1rem; }
    /* Heading block wrappers */
    .heading-block { margin: 0; padding: 0; }
    .heading-block h1, .heading-block h2, .heading-block h3 { margin-top: 0; }
    .h1-block { margin-top: 2rem; }
    .h2-block { margin-top: 1.5rem; }
    .h3-block { margin-top: 1rem; }
    p { margin-bottom: 1em; font-size: 16px; }
    ul, ol {
      margin-bottom: 1em;
      padding-left: 1.5em;
      list-style-position: outside;
    }
    ul { list-style-type: disc; }
    ol { list-style-type: decimal; }
    li {
      margin-bottom: 0.25em;
      display: list-item;
      font-size: 16px;
    }
    ul ul, ol ul { list-style-type: circle; }
    ul ul ul, ol ul ul { list-style-type: square; }
    ol ol { list-style-type: lower-alpha; }
    ol ol ol { list-style-type: lower-roman; }
    code {
      background: #f6f8fa;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 85%;
    }
    pre {
      background: #f6f8fa;
      padding: 1em;
      border-radius: 6px;
      overflow-x: auto;
      margin-bottom: 1em;
    }
    pre code {
      background: none;
      padding: 0;
      font-size: 100%;
    }
    /* Code block with header and line numbers */
    .code-block {
      background: #1e1e1e;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
    }
    .code-block .code-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 1rem;
      background: #161616;
      border-bottom: 1px solid #333;
    }
    .code-block .code-lang {
      color: #9ca3af;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .code-block .code-body {
      display: flex;
      padding: 1rem 0;
    }
    .code-block .line-numbers {
      display: flex;
      flex-direction: column;
      padding: 0 1rem 0 1rem;
      text-align: right;
      user-select: none;
      color: #6b7280;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 1rem;
      line-height: 1.625;
    }
    .code-block .line-numbers .line-number {
      display: block;
    }
    .code-block pre {
      flex: 1;
      background: transparent;
      margin: 0;
      padding: 0 1rem 0 0;
      overflow-x: auto;
    }
    .code-block pre code {
      color: #d4d4d4;
      font-size: 1rem;
      line-height: 1.625;
    }
    .terminal-block {
      background: #1e1e1e;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1em;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .terminal-block .terminal-header {
      background: linear-gradient(180deg, #3c3c3c 0%, #2d2d2d 100%);
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid #1a1a1a;
    }
    .terminal-block .terminal-dots {
      display: flex;
      gap: 8px;
    }
    .terminal-block .terminal-dots span {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .terminal-block .terminal-dots span:nth-child(1) { background: #ff5f57; }
    .terminal-block .terminal-dots span:nth-child(2) { background: #febc2e; }
    .terminal-block .terminal-dots span:nth-child(3) { background: #28c840; }
    .terminal-block .terminal-title {
      flex: 1;
      text-align: center;
      color: #9ca3af;
      font-size: 0.8rem;
      font-weight: 500;
      margin-right: 60px;
    }
    .terminal-block pre {
      background: transparent;
      margin: 0;
      padding: 1rem;
      font-family: 'JetBrains Mono', 'SF Mono', 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 16px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .terminal-block pre code {
      background: transparent;
      color: #d1d5db;
      padding: 0;
      font-size: inherit;
      font-family: inherit;
    }
    .terminal-block .terminal-prompt {
      color: #4ade80;
      user-select: none;
    }
    blockquote {
      border-left: 4px solid #ddd;
      margin: 1em 0;
      padding-left: 1em;
      color: #666;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1em;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.75em;
      text-align: left;
    }
    th {
      background: #f6f8fa;
      font-weight: 600;
    }
    a {
      color: #0969da;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    img {
      max-width: 100%;
      height: auto;
    }
    .callout {
      background: #f7f6f3;
      padding: 1em;
      border-radius: 6px;
      display: flex;
      gap: 0.75em;
      margin-bottom: 1em;
    }
    .callout-emoji {
      font-size: 1.25em;
    }
    .alert {
      padding: 1rem;
      border-radius: 6px;
      border-left: 4px solid;
      margin-bottom: 1em;
      display: flex;
      gap: 0.75rem;
    }
    .alert-info {
      background: #dbeafe;
      border-left-color: #3b82f6;
    }
    .alert-warning {
      background: #fef3c7;
      border-left-color: #f59e0b;
    }
    .alert-error {
      background: #fee2e2;
      border-left-color: #ef4444;
    }
    .alert-success {
      background: #d1fae5;
      border-left-color: #10b981;
    }
    .alert-note {
      background: #f3f4f6;
      border-left-color: #6b7280;
    }
    .alert::before {
      content: '';
      font-size: 1.25em;
    }
    .alert-info::before { content: 'ğŸ’¡'; }
    .alert-warning::before { content: 'âš ï¸'; }
    .alert-error::before { content: 'ğŸš¨'; }
    .alert-success::before { content: 'âœ…'; }
    .alert-note::before { content: 'ğŸ“Œ'; }
    .checklist-item {
      display: flex;
      align-items: start;
      gap: 0.75rem;
      margin-bottom: 0.5em;
    }
    .checklist-item input[type="checkbox"] {
      margin-top: 0.375rem;
      width: 1rem;
      height: 1rem;
      cursor: not-allowed;
    }
    .checklist-item input[type="checkbox"]:checked + span {
      text-decoration: line-through;
      color: #9ca3af;
    }
    .file-tree {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
    }
    .file-tree::before {
      content: attr(data-title);
      display: block;
      background: #f3f4f6;
      color: #6b7280;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid #e5e7eb;
    }
    .file-tree pre {
      background: transparent;
      color: #374151;
      margin: 0;
      padding: 1rem;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 14px;
      line-height: 1.6;
    }
    .video-embed {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin-bottom: 1em;
      border-radius: 6px;
    }
    .video-embed iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .file-download {
      background: #f6f8fa;
      border: 1px solid #e1e4e8;
      border-radius: 6px;
      padding: 1em;
      margin-bottom: 1em;
    }
    .file-download a {
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      color: #0969da;
      font-weight: 500;
    }
    .file-download a::before {
      content: 'ğŸ“';
    }
    .page-link-block {
      display: block;
      width: 100%;
      padding: 0.5rem;
      margin: 0 -0.5rem 1em -0.5rem;
      border-radius: 0.25rem;
      transition: background-color 0.15s;
      cursor: pointer;
    }
    .page-link-block:hover {
      background-color: #f3f4f6;
    }
    .page-link-block a {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #111827;
      font-weight: 600;
      text-decoration: underline;
    }
    .page-link-block a:hover {
      text-decoration: underline;
    }
    .page-link-block a::before {
      content: 'ğŸ“„';
      font-size: 1rem;
      flex-shrink: 0;
    }
    .profile-card {
      display: flex;
      flex-direction: column;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 1em;
      background: white;
      width: 100%;
    }
    .columns .profile-card {
      max-width: 100%;
    }
    .profile-card img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      background: #f3f4f6;
      margin: 0;
    }
    .profile-card > div {
      padding: 1rem;
    }
    .profile-card strong {
      display: block;
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }
    .profile-card em {
      display: block;
      font-size: 14px;
      font-style: normal;
      color: #6b7280;
      margin-top: 0.25rem;
    }
    .embed-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin-bottom: 1em;
      border-radius: 6px;
      border: 1px solid #e1e4e8;
    }
    .embed-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    .columns {
      display: grid;
      gap: 1.5rem;
      margin-bottom: 1em;
    }
    .columns[data-columns="2"] {
      grid-template-columns: repeat(2, 1fr);
    }
    .columns[data-columns="3"] {
      grid-template-columns: repeat(3, 1fr);
    }
    .columns[data-columns="4"] {
      grid-template-columns: repeat(4, 1fr);
    }
    .column {
      min-height: 50px;
    }
    @media (max-width: 768px) {
      .columns {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>
<div class="heading-block h1-block"><h1>Advanced React Native</h1></div>
<p>This short assignment will build off the React Native app you created in <a href="http://cs52.me/assignments/sa/react-native/">part 1</a> to search for and display YouTube videos. If you havenâ€™t completed that project yet, you should do so before starting this short assignment.</p>
<p>We will be adding authentication, video uploads, and basic animations to this app to further showcase the power of React Native.</p>
<p>âš ï¸ For this assignment, weâ€™ll be removing Expo and running the app as a bare React Native app through Xcode. Weâ€™ll also only focus on iOS development (although many of these steps are easily extendable to Android). Because of this, youâ€™ll need a Mac to complete this tutorial and you should <a href="https://apps.apple.com/us/app/xcode/id497799835">download Xcode</a> before starting.</p>
<p>âš ï¸&nbsp;This assignment is relatively long/involved. Donâ€™t hesitate to post in Slack for help with installation/dependencies/code setup or any other issues!</p>
<div class="heading-block h2-block"><h2>Ejecting from Expo</h2></div>
<p>First, weâ€™ll need to <strong>eject</strong> from our trusty Expo client (oh no!) to install and set up the dependencies weâ€™ll need for this assignment. Ejecting â€“ or the process of removing Expo and configuring your project as a standard React Native app â€“ is unnecessary in many cases. Often, it makes sense to keep all development in Expo and never eject, or only eject towards the end of development.</p>
<p>However, some modules will require you to install custom native code (usually indicated by references to â€œlinkingâ€ in the installation instructions), which requires removing Expo and exposing the iOS and Android project files. While Expo does have its own authentication and background process modules (which weâ€™ll be using), they rely on Expo API keys and generally arenâ€™t as robust or adaptable as their native equivalents.</p>
<p>âš ï¸ While Expo is constantly improving, the eject process tends to produce bugs and your app may not always compile properly straight after ejecting. If that happens, Google your error message â€“ eject errors are common enough that someone likely has documented the error youâ€™re encountering â€“ or post in the Slack group for this short assignment.</p>
<p>ğŸš€<code>git commit</code> any changes youâ€™ve made before starting. This will allow you to easily revert back if something goes wrong with the eject process or you decide to switch back to the managed workflow in the future.</p>
<p>ğŸš€Run <code>expo eject</code> in your appâ€™s directory. You can name your Android package and iOS bundle identifier whatever you want â€“ it should be unique and in the format of a <em>reverse domain name</em> (e.g. edu.dartmouth.cs.rnshort). Expo will then generate <code>ios</code> and <code>android</code> folders for you containing traditional projects that can be opened with Xcode or the Android SDK. These projects essentially serve as the bridge between your JS code and the native platform code.</p>
<p>ğŸš€After this, <a href="https://cocoapods.org/">install Cocoapods</a> if you donâ€™t already have them installed (youâ€™ll only have to do this once). Then, <code>cd</code> into your <code>ios</code> folder and run <code>pod install</code> to install all of your dependencies for iOS.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/screen-shot-2022-05-16-at-12-1767548327240.png" alt="Screen Shot 2022-05-16 at 12.36.40 PM.png">
<div class="heading-block h3-block"><h3>Xcode</h3></div>
<p>ğŸš€Next, letâ€™s check to make sure the app still compiles and builds properly. You can do this by running <code>npm run ios</code> (the equivalent of <code>expo start</code>) from the terminal to launch a simulator, but letâ€™s do this through Xcode the first time so we can easily catch any errors.</p>
<p>ğŸš€In your <code>ios</code> folder, open the <code>.xcworkspace</code> file (<strong>not</strong> <code>.xcodeproj</code>) in Xcode.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/xcode-1767548327240.png" alt="">
<p>ğŸš€Click the run button (â–¶ï¸) at the top of the screen to build and run your app on a simulator.</p>
<p>â„ï¸ Note that the build process takes a while, especially for the first time. Thatâ€™s one downside of bare React Native apps as opposed to managed Expo projects â€“ you have to wait for the Xcode compiler to bundle everything into a native app package before testing and debugging your app. Youâ€™ll still get access to hot reloading once the appâ€™s open, though.</p>
<p>At this point, if the simulator pops up with your app loaded, then youâ€™ve successfully ejected from Expo!</p>
<div class="heading-block h2-block"><h2>Upload Screen</h2></div>
<p>Letâ€™s create the screen thatâ€™ll be used to upload videos from our app. This will require another set of nested navigators to provide two ways to navigate away from our search page: to the VideoDetail component or the Upload component.</p>
<p>ğŸš€In <code>components/upload.js</code>, letâ€™s create an empty view for now to represent our Upload component.</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span></div><pre><code class="language-javascript">import React from 'react';
import { View } from 'react-native';

const Upload = (props) =&gt; {
  return &lt;View /&gt;;
};

export default Upload;</code></pre></div></div>
<div class="heading-block h3-block"><h3>Header</h3></div>
<p>Now, letâ€™s create a custom header component to allow us to navigate between our search screen and upload screen. This allows us to handle navigation ourselves, which is nice, and enables some more complex header configurations and layouts.</p>
<p>ğŸš€&nbsp;Fill in <code>components/header.js</code>:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span><span class="line-number">30</span><span class="line-number">31</span><span class="line-number">32</span><span class="line-number">33</span><span class="line-number">34</span><span class="line-number">35</span><span class="line-number">36</span><span class="line-number">37</span><span class="line-number">38</span><span class="line-number">39</span><span class="line-number">40</span><span class="line-number">41</span><span class="line-number">42</span><span class="line-number">43</span><span class="line-number">44</span><span class="line-number">45</span><span class="line-number">46</span><span class="line-number">47</span><span class="line-number">48</span><span class="line-number">49</span><span class="line-number">50</span><span class="line-number">51</span><span class="line-number">52</span><span class="line-number">53</span><span class="line-number">54</span><span class="line-number">55</span><span class="line-number">56</span><span class="line-number">57</span><span class="line-number">58</span><span class="line-number">59</span><span class="line-number">60</span><span class="line-number">61</span><span class="line-number">62</span><span class="line-number">63</span></div><pre><code class="language-javascript">import React from 'react';
import {
  View,
  StyleSheet,
  Text,
  Dimensions,
  TouchableOpacity,
} from 'react-native';
import Ionicons from 'react-native-vector-icons/FontAwesome';
import { useNavigation } from '@react-navigation/native';

const UploadHeader = ({ title }) =&gt; {
  const navigation = useNavigation();
  const isUpload = title === 'Upload a Video';

  return (
    &lt;View style={headerStyles.header}&gt;
      &lt;Text style={{ color: 'white', fontWeight: '700', fontSize: 18 }}&gt;
        {title}
      &lt;/Text&gt;
      {!isUpload ? (
        &lt;TouchableOpacity
          style={headerStyles.uploadIcon}
          onPress={() =&gt; {
            navigation.navigate('Upload');
          }}
        &gt;
          &lt;Ionicons name="upload" size={26} color="#fff" /&gt;
        &lt;/TouchableOpacity&gt;
      ) : (
        &lt;TouchableOpacity
          style={headerStyles.closeIcon}
          onPress={() =&gt; {
            navigation.goBack();
          }}
        &gt;
          &lt;Ionicons name="times" size={26} color="#fff" /&gt;
        &lt;/TouchableOpacity&gt;
      )}
    &lt;/View&gt;
  );
};

const headerStyles = StyleSheet.create({
  header: {
    backgroundColor: '#f4511e',
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    minHeight: 50,
    width: Dimensions.get('window').width,
  },
  uploadIcon: {
    position: 'absolute',
    right: 15,
  },
  closeIcon: {
    position: 'absolute',
    left: 15,
  },
});

export default UploadHeader;</code></pre></div></div>
<p>â„ï¸ Thereâ€™s a lot going on here, so letâ€™s break it down. Weâ€™re sharing this header between two screens â€“ the search view and the upload view â€“ so we pass the title in as a prop and use that to define which icon the header should display. Weâ€™re also using the <code>useNavigation</code> hook conveniently provided by React Native Navigation to handle opening and closing our screens. Finally, <code>TouchableOpacity</code> is a default React Native component that essentially serves as a more flexible button â€“ you can use it to receive onPress events and it automatically responds by decreasing the opacity of its children when pressed.</p>
<p>ğŸš€Letâ€™s update <code>search_tab.js</code> so we can display our new header. Replace the SearchTab component with the following:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span></div><pre><code class="language-javascript">const SearchTab = () =&gt; {
  return (
    &lt;Stack.Navigator&gt;
      &lt;Stack.Screen
        name="Search"
        component={SearchUploadNavigator}
        options={{ headerShown: false }}
      /&gt;
      &lt;Stack.Screen name="Detail" component={VideoDetail} /&gt;
    &lt;/Stack.Navigator&gt;
  );
};</code></pre></div></div>
<p>ğŸš€And define <code>SearchUploadNavigator</code> directly above <code>SearchTab</code> (make sure to update your imports as well):</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span><span class="line-number">30</span><span class="line-number">31</span><span class="line-number">32</span><span class="line-number">33</span><span class="line-number">34</span></div><pre><code class="language-javascript">const SearchUploadNavigator = () =&gt; {
  return (
    &lt;Stack.Navigator mode="modal" initialRouteName="SearchScreen"&gt;
      &lt;Stack.Screen
        name="SearchScreen"
        component={VideoList}
        options={{
          headerStyle: {
            backgroundColor: '#f4511e',
          },
          headerTintColor: '#fff',
          headerLeft: (props) =&gt; (
            &lt;UploadHeader {...props} title="YouTube Search" /&gt;
          ),
          title: '', // Override default title
        }}
      /&gt;
      &lt;Stack.Screen
        name="Upload"
        component={Upload}
        options={{
          headerStyle: {
            backgroundColor: '#f4511e',
          },
          headerTintColor: '#fff',
          headerLeft: (props) =&gt; (
            &lt;UploadHeader {...props} title="Upload a Video" /&gt;
          ),
          title: '',
        }}
      /&gt;
    &lt;/Stack.Navigator&gt;
  );
};</code></pre></div></div>
<p>What happened here? We kept the â€œSearchâ€ route from the original navigator, but instead of making it point to a component, we directed it to <em>another navigator</em> that controls navigation between the search and upload screens. The reason why we did this was so we could use modal navigation mode (where the view comes from the bottom instead of the side) with the Upload component. Notice how we override the header on the original navigator and use <code>SearchUploadNavigator</code> to control the custom headers.</p>
<p>â„ï¸ Also notice how we pass the <code>UploadHeader</code> component into the <code>headerTitle</code> option of <code>Stack.Screen</code>. <code>headerTitle</code> allows you to pass in another component, and since we defined the width of <code>UploadHeader</code> to be the width of the window it takes up the whole header.</p>
<p>If you did it right, you should now be able to do this:</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/upload-1767548327240.gif" alt="">
<p>Cool, right?</p>
<div class="heading-block h2-block"><h2>Firebase</h2></div>
<p>Letâ€™s connect our app with Firebase to allow us to authenticate with Google.</p>
<div class="heading-block h3-block"><h3>Configuration</h3></div>
<p>ğŸš€Go to <a href="https://firebase.google.com/">firebase.google.com</a> and create a new project.</p>
<p>ğŸš€Click the â€œiOSâ€ button on the main screen to add an iOS app to your project. The bundle ID should be the same as the one you set when ejecting from Expo â€“ if you canâ€™t remember it, then go to Xcode and check the build settings.</p>
<p>ğŸš€Download the config file generated by Firebase and add it to your projectâ€™s root in Xcode.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/firebase-config-1767548327240.png" alt="">
<p>ğŸš€While weâ€™re in Xcode, letâ€™s modify a couple of the automatically generated app files so theyâ€™re compatible with Firebase. Open <code>AppDelegate.m</code> from Xcode and add this to the top:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">#import &lt;Firebase.h&gt;</code></pre></div></div>
<p>ğŸš€And, at the top of the <code>didFinishLaunchingWithOptions</code> method, add this:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">swift</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span></div><pre><code class="language-swift">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  if ([FIRApp defaultApp] == nil) {
    [FIRApp configure];
  }
  // Rest of the default function code
}</code></pre></div></div>
<p>ğŸš€Finally, in your project directory, run <code>npm install @react-native-firebase/app</code> to add the Firebase NPM package. Then run <code>cd ios</code> and <code>pod install</code> to install its native dependencies.</p>
<ul><li><p>If this command fails, try running <code>pod repo update</code> first. Depending on the errors that you receive (e.g. you get an error about modular headers), you can add the following lines to your Podfile:</p></li></ul>
<p> Your app is now configured to use Firebase! Rebuild your app to make sure it still runs.</p>
<div class="heading-block h3-block"><h3>Authentication</h3></div>
<p>Now, letâ€™s set up authentication for our app. Although weâ€™re just using Google login in this case for the purposes of being able to upload videos to YouTube, this process can be scaled to add full user authentication to any React Native app.</p>
<p>ğŸš€In the Firebase console, click the Authentication icon in the sidebar and then the â€œSet up sign-in methodâ€ button.</p>
<p>ğŸš€Enable Google as a sign-in provider. Save the web client ID â€“ youâ€™ll need it later.</p>
<p>ğŸš€Letâ€™s define the login UI for our app. Change <code>upload.js</code> to the following:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span><span class="line-number">30</span><span class="line-number">31</span><span class="line-number">32</span></div><pre><code class="language-javascript">import React from 'react';
import { View, TouchableOpacity, Text, StyleSheet } from 'react-native';

const Upload = (props) =&gt; {
  const signInButton = () =&gt; {
    return (
      &lt;TouchableOpacity style={styles.button}&gt;
        &lt;Text style={{ color: 'white' }}&gt;Sign in with Google&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;
    );
  };

  return &lt;View style={styles.background}&gt;{signInButton()}&lt;/View&gt;;
};

const styles = StyleSheet.create({
  background: {
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
  },
  button: {
    flex: -1,
    alignItems: 'center',
    justifyContent: 'center',
    padding: 10,
    backgroundColor: '#f4511e',
    borderRadius: 5,
  },
});

export default Upload;</code></pre></div></div>
<p>ğŸš€Install the Google login SDK â€“ which Firebase will use to login with Google â€“ using <code>npm install @react-native-google-signin/google-signin @react-native-firebase/auth</code>.</p>
<p>ğŸš€Then, you know the drill â€“ <code>cd ios</code> and <code>pod install</code> to get all the native dependencies.</p>
<p>ğŸš€In Xcode, open <code>GoogleService-Info.plist</code> and copy your REVERSED_CLIENT_ID. Then, click on your project in the left sidebar and add a new URL type under the Info panel containing your REVERSED_CLIENT_ID.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/url-type-1767548327240.png" alt="">
<p>ğŸš€&nbsp;Rebuild the app to capture all your changes.</p>
<p>ğŸš€&nbsp;Letâ€™s actually try signing in! At the top of <code>upload.js</code>, add the following imports (note that this is where you use your Web Client ID from Firebase):</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span></div><pre><code class="language-javascript">import auth from '@react-native-firebase/auth';
import { GoogleSignin } from '@react-native-community/google-signin';

GoogleSignin.configure({
  webClientId: YOUR_WEB_CLIENT_ID,
  scopes: ['https://www.googleapis.com/auth/youtube.upload'],
});</code></pre></div></div>
<p>ğŸš€And then at the very top of the Upload functional component:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span></div><pre><code class="language-javascript">const Upload = (props) =&gt; {
  const [initializing, setInitializing] = useState(true);
  const [user, setUser] = useState();

  function onAuthStateChanged(newUser) {
    setUser(newUser);
    console.log(newUser);
    if (initializing) setInitializing(false);
  }

  async function onGoogleButtonPress() {
    const { idToken } = await GoogleSignin.signIn();
    const googleCredential = auth.GoogleAuthProvider.credential(idToken);
    return auth().signInWithCredential(googleCredential);
  }

  async function signInOnStart() {
    await GoogleSignin.signInSilently();
  }

  useEffect(() =&gt; {
    const subscriber = auth().onAuthStateChanged(onAuthStateChanged);
    signInOnStart();
    return subscriber; // unsubscribe on unmount
  }, []);

  if (initializing) return null;</code></pre></div></div>
<p>ğŸš€Add <code>onGoogleButtonPress</code> to the <code>onPress</code> prop of your sign in button.</p>
<p>ğŸš€Try signing in! Itâ€™ll warn you about not being a verified app, which you can safely ignore, and then prompt you to grant access to your YouTube account. After the window closes, you should see your user data printed in the console. <strong>Make sure you explicitly grant Google access to manage your YouTube account during this step.</strong></p>
<p>If you open the authentication pane of your Firebase console, you should see a new user added.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/firebase-user-1767548327240.png" alt="">
<p>â„ï¸ If youâ€™ve used other authentication APIs in the past, you might be wondering whether we need to store a refresh token or some other means of persisting the userâ€™s data between app closures. We donâ€™t want to have to login again every time we reload the app! Luckily, Firebase deals with many of the complexities behind persisting a user for you. In this case, the <code>onAuthStateChanged</code> function subscribes to authentication state changes and automatically updates the state when the component is mounted with the userâ€™s account info. Additionally, the <code>signInOnStart</code> function automatically refreshes the userâ€™s Google API access token when the component loads so that we can use it to call the YouTube API.</p>
<p>ğŸš€Finally, add an upload button and update what you return to check whether or not a user has logged in:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span></div><pre><code class="language-javascript">  const uploadButton = () =&gt; {
    return (
      &lt;TouchableOpacity style={styles.button}&gt;
        &lt;Text style={{ color: 'white' }}&gt;Upload Video&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;
    );
  };

  return (
    &lt;View style={styles.background}&gt;
      {user ? uploadButton() : signInButton()}
    &lt;/View&gt;
  );</code></pre></div></div>
<p>You should see your app change to display the new upload button. Youâ€™ve now implemented Google sign-in through Firebase for your app!</p>
<div class="heading-block h2-block"><h2>Upload Video</h2></div>
<p>Now, letâ€™s actually set up video uploading to YouTube.</p>
<div class="heading-block h3-block"><h3>Getting Video from Camera Roll</h3></div>
<p>In order to retrieve a video to upload, weâ€™ll need to ask for permission from the user to access the Camera Roll and then display a dialog prompting them to select a video. Luckily, Expo has some built-in libraries that allow us to do this fairly easily.</p>
<p>â„ï¸ But I thought we got rid of Expo? Although we ejected the app from the Expo client, we can still use Expo-made packages in our app â€“ essentially, you get the best of both worlds.</p>
<p>ğŸš€Run <code>npx expo install expo-image-picker expo-permissions</code> in your command line. Then, <code>cd ios</code> and <code>pod install</code> again.</p>
<p>ğŸš€In Xcode, open your <code>Info.plist</code> as source code by right-clicking on the file in the sidebar and selecting Open As &gt; Source Code. Then, add the following key-value pair to the bottom of the file:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">xml</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-xml">&lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;
&lt;string&gt;Give $(PRODUCT_NAME) permission to save photos&lt;/string&gt;</code></pre></div></div>
<p>ğŸš€Rebuild your app.</p>
<p>ğŸš€In <code>upload.js</code>, add the following under the <code>signInOnStart</code> function:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span></div><pre><code class="language-javascript">async function retrieveVideo() {
  const { status } = await Permissions.askAsync(Permissions.CAMERA_ROLL);
  if (status === 'granted') {
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Videos,
      allowsEditing: false,
      quality: 1,
    });
    if (!result.cancelled) {
      return result;
    }
  }
}

async function upload() {
  const video = await retrieveVideo();
  console.log(video?.uri);
}</code></pre></div></div>
<p>ğŸš€Update your imports:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span></div><pre><code class="language-javascript">import * as ImagePicker from 'expo-image-picker';
import * as Permissions from 'expo-permissions';</code></pre></div></div>
<p>ğŸš€And donâ€™t forget to add <code>upload</code> to the onPress handler of <code>uploadButton</code>!</p>
<p>â„ï¸ What is this <code>?.</code> operator we used in <code>console.log</code>? The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining">optional chaining</a> operator is new in the 2020 edition of Javascript. It allows you to check for nested properties in an object without receiving a TypeError for attempting to read properties from a missing or undefined object reference. Cool, right?</p>
<p>Now, when you click the upload button, it should prompt you to grant permission to access the Camera Roll and open a dialog to allow you to select a video. (Make sure to give the app access to your photos!) One problem â€“ if youâ€™re testing this on a simulator, there arenâ€™t any videos to select! Youâ€™ll see the console log â€œundefinedâ€ when you close the dialog. Letâ€™s fix that.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/empty-1767548327240.png" alt="">
<p>ğŸš€&nbsp;Choose a video from your hard drive and drag it onto the simulator. You can use any video â€“ I used Dartmouthâ€™s <a href="https://www.youtube.com/watch?v=fIQoLdlJPk0">2020 commencement address</a> â€“ but make sure itâ€™s at least several hundred MB so that it doesnâ€™t upload instantly.</p>
<p>âš ï¸  If you encounter an error when attempting to import your file from Finder, try moving it to a different directory and re-import it.</p>
<p>Now, you should be able to select your video from the Camera Roll and see the file URI displayed in the console.</p>
<div class="heading-block h3-block"><h3>Uploading the Video</h3></div>
<p>We <em>could</em> use Axios to upload the video, but for a large upload like this we want to allow the user to send the app to the background and conduct other tasks on the device without fear of terminating the download. Letâ€™s install another module to help us accomplish that.</p>
<p>ğŸš€&nbsp;Run <code>npm install react-native-background-upload</code> and then <code>cd ios</code> <code>pod install</code>.</p>
<p>ğŸš€&nbsp;Since we created a new Firebase project for this app and weâ€™re using that API key to authenticate the user, weâ€™ll need to re-enable access to the YouTube API. Go to your <a href="https://console.cloud.google.com/">Google Cloud console</a> (not Firebase console) and follow the instructions from Short Assignment 4 to enable the YouTube Data API. Note that you donâ€™t have to generate a new API key, just enable the API.</p>
<p>ğŸš€&nbsp;In your <code>upload</code> function, under the <code>console.log</code> add the following code:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span></div><pre><code class="language-javascript">if (video) {
  const { accessToken } = await GoogleSignin.getTokens();
  const { size } = await stat(video.uri);

  const uploadData = await axios({
    method: 'POST',
    url: 'https://www.googleapis.com/upload/youtube/v3/videos?uploadType=resumable&amp;part=snippet,status,contentDetails',
    headers: {
      Authorization: `Bearer ${accessToken}`,
      'content-type': 'application/json; charset=UTF-8',
      'x-upload-content-type': 'video/*',
      'x-upload-content-length': size,
    },
    data: {
      snippet: {
        title: 'RN Video Upload',
        categoryId: 24,
      },
      status: {
        privacyStatus: 'private',
      },
    },
  });

  const uploadUrl = uploadData?.headers?.location;
  console.log(uploadUrl);
}</code></pre></div></div>
<p>ğŸš€And, weâ€™ll need to install the <code>react-native-fs</code> module to get the video file size. Run <code>npm install react-native-fs</code> and then manually add <code>pod 'RNFS', :path =&gt; '../node_modules/react-native-fs'</code> to your Podfile like before. Then, run <code>pod install</code> and add the following import statement:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">import { stat } from 'react-native-fs';</code></pre></div></div>
<p>â„ï¸ Thereâ€™s a lot going on here, so letâ€™s break it down. YouTube follows a <a href="https://developers.google.com/youtube/v3/guides/using_resumable_upload_protocol">multi-step upload protocol</a>, and the first step is to retrieve the URL that will be used for upload. We then call YouTubeâ€™s upload API with the userâ€™s access token and details about the video to obtain the URL. Note that some of these parameters, like the video title and category, would be generated based on user input in an actual app â€“ you can see how to obtain YouTube category IDs <a href="https://developers.google.com/youtube/v3/docs/videoCategories/list">here</a>.</p>
<p>âš ï¸ For basic versions of the API, thereâ€™s a quota on the amount of times you can call this API endpoint per day â€“ make sure to not test these steps more than a couple times once you get it working, or you may encounter 403 errors until midnight Pacific Time the next day.</p>
<p>ğŸš€Letâ€™s actually upload the video now! Replace the last <code>console.log</code> with the following:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span><span class="line-number">20</span><span class="line-number">21</span><span class="line-number">22</span><span class="line-number">23</span><span class="line-number">24</span><span class="line-number">25</span><span class="line-number">26</span><span class="line-number">27</span><span class="line-number">28</span><span class="line-number">29</span></div><pre><code class="language-javascript">const uploadOptions = {
  url: uploadUrl,
  path: video.uri,
  method: 'PUT',
  type: 'raw',
  headers: {
    Authorization: `Bearer ${accessToken}`,
    'content-type': 'video/*',
    'content-length': size,
  },
};

BackgroundUpload.startUpload(uploadOptions)
  .then((uploadId) =&gt; {
    BackgroundUpload.addListener('progress', uploadId, (data) =&gt; {
      console.log(data.progress);
      setProgress(data.progress);

      if (progress === 100) {
        setProgress(0);
      }
    });
    BackgroundUpload.addListener('error', uploadId, (data) =&gt; {
      console.log(`Error: ${data.error}`);
    });
  })
  .catch((err) =&gt; {
    console.log(err);
  });</code></pre></div></div>
<p>ğŸš€Update your imports:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">import BackgroundUpload from 'react-native-background-upload';</code></pre></div></div>
<p>ğŸš€And of course, add another variable to your state configuration:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">const [progress, setProgress] = useState(0);</code></pre></div></div>
<p>Now, after selecting your video, you should see the progress logged in the console as it uploads.</p>
<div class="heading-block h3-block"><h3>Progress Bar</h3></div>
<p>Just logging our progress isnâ€™t very interesting, though. We want to keep the user informed of how much their upload has progressed.</p>
<p>ğŸš€Letâ€™s create a <code>progressBar</code> function to render a progress bar. Under where you have <code>uploadButton</code>:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span></div><pre><code class="language-javascript">const progressBar = () =&gt; {
  return (
    &lt;&gt;
      &lt;View style={styles.progressBar}&gt;
        &lt;View style={[styles.progress, { width: `${progress}%` }]} /&gt;
      &lt;/View&gt;
      &lt;Text style={{ marginTop: 20 }}&gt;{`${Math.floor(progress)}%`}&lt;/Text&gt;
    &lt;/&gt;
  );
};</code></pre></div></div>
<p>ğŸš€Update your return block to conditionally check for progress:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span></div><pre><code class="language-javascript">return (
  &lt;View style={styles.background}&gt;
    {progress &gt; 0 &amp;&amp; progressBar()}
    {progress === 0 &amp;&amp; (user ? uploadButton() : signInButton())}
  &lt;/View&gt;
);</code></pre></div></div>
<p>ğŸš€And add some styles:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span></div><pre><code class="language-javascript">  progressBar: {
    width: '80%',
    height: 25,
    backgroundColor: 'rgba(0,0,0,0.2)',
    borderRadius: 5,
  },
  progress: {
    position: 'absolute',
    left: 0,
    height: 25,
    backgroundColor: '#f4511e',
    borderRadius: 5,
  },</code></pre></div></div>
<p>It should look like this:</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/progress-1767548327240.png" alt="">
<p>ğŸš€But wait! If we close the upload modal and wait for the component to unmount, when we open it again we donâ€™t have access to the progress bar from before! Letâ€™s update our <code>useEffect</code> hook to listen for a progress event when the modal opens:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span></div><pre><code class="language-javascript">useEffect(() =&gt; {
  const subscriber = auth().onAuthStateChanged(onAuthStateChanged);
  signInOnStart();

  BackgroundUpload.addListener('progress', null, (data) =&gt; {
    console.log(data.progress);
    setProgress(data.progress);

    if (progress === 100) {
      setProgress(0);
    }
  });

  return () =&gt; {
    subscriber(); // unsubscribe on unmount
    DeviceEventEmitter.removeAllListeners();
  };
}, []);</code></pre></div></div>
<p>ğŸš€And add <code>DeviceEventEmitter</code> to your <code>react-native</code> imports.</p>
<p>â„ï¸ What does useEffect do? useEffect is a React hook designed to mirror the functionality of componentDidMount, componentDidUpdate, and componentWillUnmount in functional components. Here, the empty dependency array [] supplied as the second parameter to the hook specifies that the function should run once upon mount, and returns a cleanup function for our event subscriptions that will run on unmount. You can add objects to the dependency array to specify that useEffect should run when one of those parameters changes.</p>
<p>ğŸš€&nbsp;If you run into a â€œ403: Quota Exceededâ€ error when attempting this code, thatâ€™s okay! You can still submit and receive credit if the rest of the code is there. YouTube restricts you to 4-5 upload requests a day on the free tier, so donâ€™t try uploading until youâ€™re sure you have it right.</p>
<p><a href="https://emojipedia.org/warning/">**âš ï¸</a>** If you get a 401 unauthorized error, make sure the account youâ€™re signing in with has a YouTube channel associated with it!</p>
<div class="heading-block h2-block"><h2>Animation</h2></div>
<p>Finally, letâ€™s add some animations to our upload screen to make it more interesting.</p>
<div class="heading-block h3-block"><h3>Lottie</h3></div>
<p>ğŸš€Run <code>npm i lottie-ios@3.1.8 lottie-react-native@3.5.0</code>, then <code>cd ios</code> and <code>pod install</code>. This adds <a href="https://github.com/react-native-community/lottie-react-native">Lottie</a> to your project, a framework that parses Adobe After Effects animations and renders them natively on mobile.</p>
<p>ğŸš€Weâ€™re going to add an animation from <a href="https://lottiefiles.com/">LottieFiles</a>, a free library of Lottie animations that you can download and use in your projects. Weâ€™re going to be using <a href="https://lottiefiles.com/196-material-wave-loading">this</a> loading indicator, which you can download below. Download it and put it in your <code>assets</code> folder.</p>
<p><a href="ECSA%20React%20Native%20%E2%80%94%20Part%202/196-material-wave-loading.json">196-material-wave-loading.json</a></p>
<p>ğŸš€In <code>upload.js</code>, add the following import:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">import LottieView from 'lottie-react-native';</code></pre></div></div>
<p>ğŸš€And update your <code>progressBar</code> function:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span></div><pre><code class="language-javascript">const progressBar = () =&gt; {
  return (
    &lt;&gt;
      &lt;LottieView
        source={require('../assets/196-material-wave-loading.json')}
        autoPlay
        loop
        style={{ marginBottom: 100 }}
      /&gt;
      &lt;View style={styles.progressBar}&gt;
        &lt;View style={[styles.progress, { width: `${progress}%` }]} /&gt;
      &lt;/View&gt;
      &lt;Text style={{ marginTop: 20 }}&gt;{`${Math.floor(progress)}%`}&lt;/Text&gt;
    &lt;/&gt;
  );
};</code></pre></div></div>
<p>You should now have a nice complement to your progress bar.</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/lottie-1767548327240.png" alt="">
<div class="heading-block h3-block"><h3>React Native Animatable</h3></div>
<p>React Native Animatable is a library that makes it easy to animate <code>components</code> in React Native. Letâ€™s use it to spruce up our upload button.</p>
<p>ğŸš€Run <code>npm install react-native-animatable</code>.</p>
<p>ğŸš€Import the module:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span></div><pre><code class="language-javascript">import * as Animatable from 'react-native-animatable';</code></pre></div></div>
<p>ğŸš€Then, wrap your button components in Animatable.View, like so:</p>
<div class="code-block"><div class="code-header"><span class="code-lang">JavaScript</span></div><div class="code-body"><div class="line-numbers"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span><span class="line-number">15</span><span class="line-number">16</span><span class="line-number">17</span><span class="line-number">18</span><span class="line-number">19</span></div><pre><code class="language-javascript">const signInButton = () =&gt; {
  return (
    &lt;Animatable.View animation="fadeInLeft" delay={500}&gt;
      &lt;TouchableOpacity style={styles.button} onPress={onGoogleButtonPress}&gt;
        &lt;Text style={{ color: 'white' }}&gt;Sign in with Google&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;
    &lt;/Animatable.View&gt;
  );
};

const uploadButton = () =&gt; {
  return (
    &lt;Animatable.View animation="fadeInLeft" delay={500}&gt;
      &lt;TouchableOpacity style={styles.button} onPress={upload}&gt;
        &lt;Text style={{ color: 'white' }}&gt;Upload Video&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;
    &lt;/Animatable.View&gt;
  );
};</code></pre></div></div>
<p>That was easy!</p>
<img src="https://raw.githubusercontent.com/dartmouth-cs52/content-dartmouth-cs52-26w/main/pages/ecsa-react-native-part-2/assets/animation-1767548327240.gif" alt="">
<div class="heading-block h2-block"><h2>Weâ€™re done!</h2></div>
<p>You successfully took off the Expo training wheels and built a full-fledged video uploader, complete with animations, background loading, and Firebase authentication. And you did it without having to write a single line of native code!</p>
<p>Thereâ€™s a lot going on in <code>upload.js</code> â€“ think about how youâ€™d divide up the code and organize a larger React or React Native project.</p>
<p>We breezed through Firebase and the YouTube API, but thereâ€™s a lot more functionality to them thatâ€™s accessible with a simple <code>npm install</code>.</p>
<div class="heading-block h2-block"><h2>Submission</h2></div>
<p>To submit, create a new comment on your react-native short assignment. </p>
<div class="heading-block h2-block"><h2>Resources</h2></div>
<ul><li><a href="https://rnfirebase.io/auth/social-auth">https://rnfirebase.io/auth/social-auth</a></li><li><a href="https://github.com/react-native-community/google-signin">https://github.com/react-native-community/google-signin</a></li><li><a href="https://developers.google.com/youtube/v3/guides/using_resumable_upload_protocol">https://developers.google.com/youtube/v3/guides/using_resumable_upload_protocol</a></li><li><a href="https://docs.expo.io/versions/latest/sdk/imagepicker">https://docs.expo.io/versions/latest/sdk/imagepicker</a></li><li><a href="https://github.com/Vydia/react-native-background-upload">https://github.com/Vydia/react-native-background-upload</a></li></ul>
</body>
</html>